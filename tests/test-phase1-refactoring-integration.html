<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 1 ë¦¬íŒ©í† ë§ í†µí•© í…ŒìŠ¤íŠ¸ - TravelLog</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f8fafc;
            color: #1a202c;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .header h1 {
            color: #2d3748;
            font-size: 2.5rem;
            margin: 0 0 10px 0;
        }
        
        .header .subtitle {
            color: #718096;
            font-size: 1.1rem;
        }
        
        .test-section {
            margin: 30px 0;
            padding: 25px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: #f7fafc;
        }
        
        .test-section h2 {
            color: #2b6cb0;
            margin: 0 0 20px 0;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .test-item {
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 6px;
            border-left: 4px solid #4299e1;
        }
        
        .test-item.success {
            border-left-color: #48bb78;
            background-color: #f0fff4;
        }
        
        .test-item.error {
            border-left-color: #f56565;
            background-color: #fff5f5;
        }
        
        .test-item.warning {
            border-left-color: #ed8936;
            background-color: #fffaf0;
        }
        
        .test-name {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 8px;
        }
        
        .test-result {
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            color: #4a5568;
            white-space: pre-wrap;
        }
        
        .performance-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .metric-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            text-align: center;
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #2b6cb0;
            margin-bottom: 5px;
        }
        
        .metric-label {
            color: #718096;
            font-size: 0.9rem;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-pass { background-color: #48bb78; }
        .status-fail { background-color: #f56565; }
        .status-warn { background-color: #ed8936; }
        
        .summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 8px;
            margin-top: 30px;
        }
        
        .summary h3 {
            margin: 0 0 15px 0;
            font-size: 1.3rem;
        }
        
        .run-button {
            background: #4299e1;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 1rem;
            cursor: pointer;
            margin: 10px 5px;
            transition: background-color 0.2s;
        }
        
        .run-button:hover {
            background: #3182ce;
        }
        
        .run-button:disabled {
            background: #a0aec0;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ Phase 1 ë¦¬íŒ©í† ë§ í†µí•© í…ŒìŠ¤íŠ¸</h1>
            <p class="subtitle">AnalysisOrchestrator ë° ë¶„ì„ ëª¨ë“ˆë“¤ì˜ ì„±ëŠ¥ ë° ê¸°ëŠ¥ ê²€ì¦</p>
        </div>

        <div style="text-align: center; margin-bottom: 30px;">
            <button class="run-button" onclick="runAllTests()">ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
            <button class="run-button" onclick="runPerformanceTest()">ì„±ëŠ¥ í…ŒìŠ¤íŠ¸</button>
            <button class="run-button" onclick="runCompatibilityTest()">í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸</button>
            <button class="run-button" onclick="clearResults()">ê²°ê³¼ ì´ˆê¸°í™”</button>
        </div>

        <!-- ëª¨ë“ˆ ë¡œë”© í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <h2>ğŸ”§ ëª¨ë“ˆ ë¡œë”© ë° ì´ˆê¸°í™” í…ŒìŠ¤íŠ¸</h2>
            <div id="module-loading-tests">
                <div class="test-item">
                    <div class="test-name">í…ŒìŠ¤íŠ¸ ì¤€ë¹„ ì¤‘...</div>
                    <div class="test-result">í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ë ¤ë©´ "ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</div>
                </div>
            </div>
        </div>

        <!-- ê¸°ëŠ¥ì„± í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <h2>âš™ï¸ ê¸°ëŠ¥ì„± í…ŒìŠ¤íŠ¸</h2>
            <div id="functionality-tests">
                <div class="test-item">
                    <div class="test-name">í…ŒìŠ¤íŠ¸ ì¤€ë¹„ ì¤‘...</div>
                    <div class="test-result">ë¶„ì„ ê¸°ëŠ¥ë“¤ì˜ ì •í™•ì„±ì„ ê²€ì¦í•©ë‹ˆë‹¤.</div>
                </div>
            </div>
        </div>

        <!-- ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <h2>âš¡ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸</h2>
            <div id="performance-tests">
                <div class="test-item">
                    <div class="test-name">í…ŒìŠ¤íŠ¸ ì¤€ë¹„ ì¤‘...</div>
                    <div class="test-result">ìƒˆë¡œìš´ ëª¨ë“ˆë“¤ì˜ ì„±ëŠ¥ì„ ì¸¡ì •í•©ë‹ˆë‹¤.</div>
                </div>
            </div>
            <div class="performance-metrics" id="performance-metrics">
                <!-- ì„±ëŠ¥ ì§€í‘œë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <!-- í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <h2>ğŸ”„ í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸</h2>
            <div id="compatibility-tests">
                <div class="test-item">
                    <div class="test-name">í…ŒìŠ¤íŠ¸ ì¤€ë¹„ ì¤‘...</div>
                    <div class="test-result">ê¸°ì¡´ APIì™€ì˜ í˜¸í™˜ì„±ì„ í™•ì¸í•©ë‹ˆë‹¤.</div>
                </div>
            </div>
        </div>

        <!-- ë©”ëª¨ë¦¬ ë° ë¦¬ì†ŒìŠ¤ í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <h2>ğŸ’¾ ë©”ëª¨ë¦¬ ë° ë¦¬ì†ŒìŠ¤ í…ŒìŠ¤íŠ¸</h2>
            <div id="memory-tests">
                <div class="test-item">
                    <div class="test-name">í…ŒìŠ¤íŠ¸ ì¤€ë¹„ ì¤‘...</div>
                    <div class="test-result">ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ë° ë¦¬ì†ŒìŠ¤ ì •ë¦¬ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.</div>
                </div>
            </div>
        </div>

        <!-- í…ŒìŠ¤íŠ¸ ìš”ì•½ -->
        <div class="summary" id="test-summary" style="display: none;">
            <h3>ğŸ“Š í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½</h3>
            <div id="summary-content">
                <!-- ìš”ì•½ ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>

    <script type="module">
        // í…ŒìŠ¤íŠ¸ì— í•„ìš”í•œ ëª¨ë“ˆë“¤ import
        import { MyLogsController } from '../js/tabs/my-logs/controllers/MyLogsController.js';
        import { LogDataService } from '../js/modules/services/log-data-service.js';
        import { CacheManager } from '../js/modules/services/cache-manager.js';
        import { AnalysisOrchestrator } from '../js/modules/analysis/AnalysisOrchestrator.js';
        import { CountryAnalysisManager } from '../js/modules/analysis/CountryAnalysisManager.js';
        import { ExplorationStatsManager } from '../js/modules/analysis/ExplorationStatsManager.js';
        import { YearlyComparisonManager } from '../js/modules/analysis/YearlyComparisonManager.js';
        import { DemoData } from '../js/modules/utils/demo-data.js';

        // ê¸€ë¡œë²Œ í…ŒìŠ¤íŠ¸ ìƒíƒœ
        window.testState = {
            results: [],
            controller: null,
            startTime: null,
            metrics: {}
        };

        // í…ŒìŠ¤íŠ¸ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        function createTestItem(name, result, status = 'success') {
            return `
                <div class="test-item ${status}">
                    <div class="test-name">
                        <span class="status-indicator status-${status === 'success' ? 'pass' : status === 'error' ? 'fail' : 'warn'}"></span>
                        ${name}
                    </div>
                    <div class="test-result">${result}</div>
                </div>
            `;
        }

        function updateTestSection(sectionId, content) {
            document.getElementById(sectionId).innerHTML = content;
        }

        function measurePerformance(name, fn) {
            const start = performance.now();
            const result = fn();
            const end = performance.now();
            const duration = Math.round((end - start) * 100) / 100;
            
            window.testState.metrics[name] = duration;
            return { result, duration };
        }

        async function measureAsyncPerformance(name, fn) {
            const start = performance.now();
            const result = await fn();
            const end = performance.now();
            const duration = Math.round((end - start) * 100) / 100;
            
            window.testState.metrics[name] = duration;
            return { result, duration };
        }

        // 1. ëª¨ë“ˆ ë¡œë”© í…ŒìŠ¤íŠ¸
        async function testModuleLoading() {
            let results = [];

            try {
                // LogDataService í…ŒìŠ¤íŠ¸
                const logDataService = new LogDataService();
                results.push(createTestItem(
                    'LogDataService ë¡œë”©',
                    `âœ… ì„±ê³µì ìœ¼ë¡œ ë¡œë“œë¨\nì¸ìŠ¤í„´ìŠ¤ íƒ€ì…: ${logDataService.constructor.name}`,
                    'success'
                ));

                // CacheManager í…ŒìŠ¤íŠ¸
                const cacheManager = new CacheManager();
                results.push(createTestItem(
                    'CacheManager ë¡œë”©',
                    `âœ… ì„±ê³µì ìœ¼ë¡œ ë¡œë“œë¨\nì¸ìŠ¤í„´ìŠ¤ íƒ€ì…: ${cacheManager.constructor.name}`,
                    'success'
                ));

                // AnalysisOrchestrator í…ŒìŠ¤íŠ¸
                const analysisOrchestrator = new AnalysisOrchestrator(logDataService, cacheManager);
                results.push(createTestItem(
                    'AnalysisOrchestrator ë¡œë”©',
                    `âœ… ì„±ê³µì ìœ¼ë¡œ ë¡œë“œë¨\nì˜ì¡´ì„± ì£¼ì…: ${logDataService ? 'âœ…' : 'âŒ'} LogDataService, ${cacheManager ? 'âœ…' : 'âŒ'} CacheManager`,
                    'success'
                ));

                // ê°œë³„ ë¶„ì„ ë§¤ë‹ˆì €ë“¤ í…ŒìŠ¤íŠ¸
                const countryManager = new CountryAnalysisManager(logDataService, cacheManager);
                const explorationManager = new ExplorationStatsManager(logDataService, cacheManager);
                const yearlyManager = new YearlyComparisonManager(logDataService, cacheManager);

                results.push(createTestItem(
                    'ë¶„ì„ ë§¤ë‹ˆì €ë“¤ ë¡œë”©',
                    `âœ… CountryAnalysisManager: ${countryManager ? 'ë¡œë“œë¨' : 'ì‹¤íŒ¨'}\nâœ… ExplorationStatsManager: ${explorationManager ? 'ë¡œë“œë¨' : 'ì‹¤íŒ¨'}\nâœ… YearlyComparisonManager: ${yearlyManager ? 'ë¡œë“œë¨' : 'ì‹¤íŒ¨'}`,
                    'success'
                ));

                // MyLogsController í†µí•© í…ŒìŠ¤íŠ¸
                const controller = new MyLogsController();
                await controller.initialize();
                
                results.push(createTestItem(
                    'MyLogsController í†µí•© ì´ˆê¸°í™”',
                    `âœ… ì»¨íŠ¸ë¡¤ëŸ¬ ì´ˆê¸°í™” ì™„ë£Œ\nâœ… AnalysisOrchestrator í†µí•©: ${controller.analysisOrchestrator ? 'ì„±ê³µ' : 'ì‹¤íŒ¨'}\nì´ˆê¸°í™” ìƒíƒœ: ${controller.isInitialized}`,
                    'success'
                ));

                window.testState.controller = controller;

            } catch (error) {
                results.push(createTestItem(
                    'ëª¨ë“ˆ ë¡œë”© ì‹¤íŒ¨',
                    `âŒ ì˜¤ë¥˜ ë°œìƒ: ${error.message}\nìŠ¤íƒ: ${error.stack}`,
                    'error'
                ));
            }

            updateTestSection('module-loading-tests', results.join(''));
        }

        // 2. ê¸°ëŠ¥ì„± í…ŒìŠ¤íŠ¸
        async function testFunctionality() {
            let results = [];
            const controller = window.testState.controller;

            if (!controller) {
                results.push(createTestItem(
                    'ê¸°ëŠ¥ì„± í…ŒìŠ¤íŠ¸ ì¤€ë¹„ ì‹¤íŒ¨',
                    'âŒ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë¨¼ì € ëª¨ë“ˆ ë¡œë”© í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”.',
                    'error'
                ));
                updateTestSection('functionality-tests', results.join(''));
                return;
            }

            try {
                // ë°ëª¨ ë°ì´í„° ì¶”ê°€
                controller.addDemoData();
                
                // ê¸°ë³¸ í†µê³„ í…ŒìŠ¤íŠ¸
                const { result: basicStats, duration: basicStatsDuration } = await measureAsyncPerformance(
                    'BasicStats',
                    () => controller.analysisOrchestrator.getBasicStats()
                );
                
                results.push(createTestItem(
                    'ê¸°ë³¸ í†µê³„ ë¶„ì„',
                    `âœ… ì‹¤í–‰ ì‹œê°„: ${basicStatsDuration}ms\nì´ ì—¬í–‰: ${basicStats.totalTrips}íšŒ\në°©ë¬¸ êµ­ê°€: ${basicStats.uniqueCountries}ê°œ\nì´ ì—¬í–‰ì¼: ${basicStats.totalTravelDays}ì¼\ní‰ê·  ë³„ì : ${basicStats.averageRating}ì `,
                    'success'
                ));

                // êµ­ê°€ë³„ ë¶„ì„ í…ŒìŠ¤íŠ¸
                const { result: countryAnalysis, duration: countryDuration } = await measureAsyncPerformance(
                    'CountryAnalysis',
                    () => controller.getFavoriteCountryAnalysis()
                );

                results.push(createTestItem(
                    'ì£¼ìš”ë°©ë¬¸êµ­ ë¶„ì„',
                    `âœ… ì‹¤í–‰ ì‹œê°„: ${countryDuration}ms\në¶„ì„ëœ êµ­ê°€ ìˆ˜: ${countryAnalysis.totalVisitedCountries}ê°œ\nìƒìœ„ êµ­ê°€: ${countryAnalysis.favoriteCountries.slice(0, 3).map(c => c.displayName).join(', ')}`,
                    'success'
                ));

                // ì „ì„¸ê³„ íƒí—˜ í†µê³„ í…ŒìŠ¤íŠ¸
                const { result: worldStats, duration: worldDuration } = await measureAsyncPerformance(
                    'WorldExploration',
                    () => controller.getWorldExplorationStats()
                );

                results.push(createTestItem(
                    'ì „ì„¸ê³„ íƒí—˜ í†µê³„',
                    `âœ… ì‹¤í–‰ ì‹œê°„: ${worldDuration}ms\në°©ë¬¸í•œ êµ­ê°€: ${worldStats.visitedCountries}/${worldStats.totalCountries}ê°œ\níƒí—˜ ì§„í–‰ë¥ : ${worldStats.progressPercentage}%\nëŒ€ë¥™ë³„ ë°ì´í„°: ${worldStats.continentStats.length}ê°œ ëŒ€ë¥™`,
                    'success'
                ));

                // ì—°ë„ë³„ ë¶„ì„ í…ŒìŠ¤íŠ¸
                const currentYear = new Date().getFullYear().toString();
                const { result: yearlyStats, duration: yearlyDuration } = await measureAsyncPerformance(
                    'YearlyAnalysis',
                    () => controller.getYearlyStatsAnalysis(currentYear)
                );

                results.push(createTestItem(
                    'ì—°ë„ë³„ í†µê³„ ë¶„ì„',
                    `âœ… ì‹¤í–‰ ì‹œê°„: ${yearlyDuration}ms\në¶„ì„ ì—°ë„: ${yearlyStats.year}\ní˜„ì¬ ì—°ë„ ë°ì´í„°: ${yearlyStats.hasCurrentData ? 'ìˆìŒ' : 'ì—†ìŒ'}\nì „ë…„ë„ ë°ì´í„°: ${yearlyStats.hasPreviousData ? 'ìˆìŒ' : 'ì—†ìŒ'}`,
                    'success'
                ));

            } catch (error) {
                results.push(createTestItem(
                    'ê¸°ëŠ¥ì„± í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨',
                    `âŒ ì˜¤ë¥˜ ë°œìƒ: ${error.message}\nìŠ¤íƒ: ${error.stack}`,
                    'error'
                ));
            }

            updateTestSection('functionality-tests', results.join(''));
        }

        // 3. ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
        async function testPerformance() {
            let results = [];
            const controller = window.testState.controller;

            if (!controller) {
                results.push(createTestItem(
                    'ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì¤€ë¹„ ì‹¤íŒ¨',
                    'âŒ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.',
                    'error'
                ));
                updateTestSection('performance-tests', results.join(''));
                return;
            }

            try {
                // ëŒ€ìš©ëŸ‰ í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±
                const testLogs = [];
                for (let i = 0; i < 1000; i++) {
                    testLogs.push({
                        id: `test-${i}`,
                        country: ['JP', 'KR', 'US', 'FR', 'DE'][i % 5],
                        city: `City-${i}`,
                        startDate: new Date(2020 + (i % 4), i % 12, (i % 28) + 1).toISOString(),
                        endDate: new Date(2020 + (i % 4), i % 12, (i % 28) + 3).toISOString(),
                        rating: (i % 5) + 1,
                        purpose: ['business', 'leisure', 'family'][i % 3]
                    });
                }

                controller.logDataService.setLogs(testLogs);

                // ìºì‹œ ì—†ì´ ì„±ëŠ¥ ì¸¡ì •
                controller.invalidateCache();
                
                const uncachedMetrics = {};
                uncachedMetrics.basicStats = await measureAsyncPerformance('BasicStats_Uncached', () => 
                    controller.analysisOrchestrator.getBasicStats()
                );
                
                uncachedMetrics.countryAnalysis = await measureAsyncPerformance('CountryAnalysis_Uncached', () => 
                    controller.getFavoriteCountryAnalysis()
                );
                
                uncachedMetrics.worldStats = await measureAsyncPerformance('WorldStats_Uncached', () => 
                    controller.getWorldExplorationStats()
                );

                // ìºì‹œëœ ìƒíƒœì—ì„œ ì„±ëŠ¥ ì¸¡ì •
                const cachedMetrics = {};
                cachedMetrics.basicStats = await measureAsyncPerformance('BasicStats_Cached', () => 
                    controller.analysisOrchestrator.getBasicStats()
                );
                
                cachedMetrics.countryAnalysis = await measureAsyncPerformance('CountryAnalysis_Cached', () => 
                    controller.getFavoriteCountryAnalysis()
                );
                
                cachedMetrics.worldStats = await measureAsyncPerformance('WorldStats_Cached', () => 
                    controller.getWorldExplorationStats()
                );

                results.push(createTestItem(
                    'ëŒ€ìš©ëŸ‰ ë°ì´í„° ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ (1000ê°œ ë¡œê·¸)',
                    `ğŸ“Š ìºì‹œ ì—†ìŒ vs ìºì‹œ ìˆìŒ ë¹„êµ:\n\n` +
                    `ê¸°ë³¸ í†µê³„: ${uncachedMetrics.basicStats.duration}ms â†’ ${cachedMetrics.basicStats.duration}ms (${Math.round((1 - cachedMetrics.basicStats.duration / uncachedMetrics.basicStats.duration) * 100)}% ê°œì„ )\n` +
                    `êµ­ê°€ ë¶„ì„: ${uncachedMetrics.countryAnalysis.duration}ms â†’ ${cachedMetrics.countryAnalysis.duration}ms (${Math.round((1 - cachedMetrics.countryAnalysis.duration / uncachedMetrics.countryAnalysis.duration) * 100)}% ê°œì„ )\n` +
                    `ì„¸ê³„ í†µê³„: ${uncachedMetrics.worldStats.duration}ms â†’ ${cachedMetrics.worldStats.duration}ms (${Math.round((1 - cachedMetrics.worldStats.duration / uncachedMetrics.worldStats.duration) * 100)}% ê°œì„ )`,
                    'success'
                ));

                // ì„±ëŠ¥ ì§€í‘œ ì¹´ë“œ ìƒì„±
                const metricsHTML = `
                    <div class="metric-card">
                        <div class="metric-value">${uncachedMetrics.basicStats.duration}ms</div>
                        <div class="metric-label">ê¸°ë³¸ í†µê³„ (ìºì‹œ ì—†ìŒ)</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${cachedMetrics.basicStats.duration}ms</div>
                        <div class="metric-label">ê¸°ë³¸ í†µê³„ (ìºì‹œ ìˆìŒ)</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${uncachedMetrics.countryAnalysis.duration}ms</div>
                        <div class="metric-label">êµ­ê°€ ë¶„ì„ (ìºì‹œ ì—†ìŒ)</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${cachedMetrics.countryAnalysis.duration}ms</div>
                        <div class="metric-label">êµ­ê°€ ë¶„ì„ (ìºì‹œ ìˆìŒ)</div>
                    </div>
                `;
                
                document.getElementById('performance-metrics').innerHTML = metricsHTML;

            } catch (error) {
                results.push(createTestItem(
                    'ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨',
                    `âŒ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`,
                    'error'
                ));
            }

            updateTestSection('performance-tests', results.join(''));
        }

        // 4. í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸
        async function testCompatibility() {
            let results = [];
            const controller = window.testState.controller;

            if (!controller) {
                results.push(createTestItem(
                    'í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸ ì¤€ë¹„ ì‹¤íŒ¨',
                    'âŒ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.',
                    'error'
                ));
                updateTestSection('compatibility-tests', results.join(''));
                return;
            }

            try {
                // ê¸°ì¡´ API í˜¸í™˜ì„± í™•ì¸
                const legacyMethods = [
                    'getAllLogs',
                    'getLogById', 
                    'addLog',
                    'deleteLog',
                    'updateLog',
                    'getBasicStats',
                    'getPurposeAnalysis',
                    'getCountryVisitCounts',
                    'getFavoriteCountryAnalysis',
                    'getYearlyStatsAnalysis',
                    'getWorldExplorationStats',
                    'getContinentStats'
                ];

                let compatibilityScore = 0;
                const methodResults = [];

                for (const method of legacyMethods) {
                    try {
                        const hasMethod = typeof controller[method] === 'function';
                        if (hasMethod) {
                            compatibilityScore++;
                            methodResults.push(`âœ… ${method}: í˜¸í™˜ë¨`);
                        } else {
                            methodResults.push(`âŒ ${method}: ëˆ„ë½ë¨`);
                        }
                    } catch (error) {
                        methodResults.push(`âš ï¸ ${method}: ì˜¤ë¥˜ - ${error.message}`);
                    }
                }

                const compatibilityPercentage = Math.round((compatibilityScore / legacyMethods.length) * 100);

                results.push(createTestItem(
                    'API í˜¸í™˜ì„± ê²€ì¦',
                    `ğŸ“Š í˜¸í™˜ì„± ì ìˆ˜: ${compatibilityScore}/${legacyMethods.length} (${compatibilityPercentage}%)\n\n${methodResults.join('\n')}`,
                    compatibilityPercentage >= 90 ? 'success' : compatibilityPercentage >= 70 ? 'warning' : 'error'
                ));

                // Fallback ë©”ì»¤ë‹ˆì¦˜ í…ŒìŠ¤íŠ¸
                try {
                    // ì˜ë„ì ìœ¼ë¡œ analysisOrchestratorë¥¼ ë¹„í™œì„±í™”í•˜ì—¬ fallback í…ŒìŠ¤íŠ¸
                    const originalOrchestrator = controller.analysisOrchestrator;
                    controller.analysisOrchestrator = null;

                    const fallbackResult = controller.getFavoriteCountryAnalysis();
                    
                    // ì›ë³µ
                    controller.analysisOrchestrator = originalOrchestrator;

                    results.push(createTestItem(
                        'Fallback ë©”ì»¤ë‹ˆì¦˜ í…ŒìŠ¤íŠ¸',
                        `âœ… AnalysisOrchestrator ë¹„í™œì„±í™” ìƒíƒœì—ì„œë„ ì •ìƒ ë™ì‘\nê²°ê³¼ íƒ€ì…: ${typeof fallbackResult}\në°ì´í„° ìœ ë¬´: ${fallbackResult && Object.keys(fallbackResult).length > 0 ? 'ìˆìŒ' : 'ì—†ìŒ'}`,
                        'success'
                    ));

                } catch (error) {
                    results.push(createTestItem(
                        'Fallback ë©”ì»¤ë‹ˆì¦˜ í…ŒìŠ¤íŠ¸',
                        `âŒ Fallback ì‹¤íŒ¨: ${error.message}`,
                        'error'
                    ));
                }

            } catch (error) {
                results.push(createTestItem(
                    'í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨',
                    `âŒ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`,
                    'error'
                ));
            }

            updateTestSection('compatibility-tests', results.join(''));
        }

        // 5. ë©”ëª¨ë¦¬ í…ŒìŠ¤íŠ¸
        async function testMemory() {
            let results = [];
            const controller = window.testState.controller;

            if (!controller) {
                results.push(createTestItem(
                    'ë©”ëª¨ë¦¬ í…ŒìŠ¤íŠ¸ ì¤€ë¹„ ì‹¤íŒ¨',
                    'âŒ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.',
                    'error'
                ));
                updateTestSection('memory-tests', results.join(''));
                return;
            }

            try {
                // ì´ˆê¸° ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰
                const initialMemory = performance.memory ? {
                    used: performance.memory.usedJSHeapSize,
                    total: performance.memory.totalJSHeapSize
                } : null;

                // ëŒ€ëŸ‰ ì—°ì‚° ìˆ˜í–‰
                for (let i = 0; i < 100; i++) {
                    await controller.analysisOrchestrator.getBasicStats();
                    await controller.getFavoriteCountryAnalysis();
                    await controller.getWorldExplorationStats();
                }

                // ì¤‘ê°„ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰
                const midMemory = performance.memory ? {
                    used: performance.memory.usedJSHeapSize,
                    total: performance.memory.totalJSHeapSize
                } : null;

                // ì •ë¦¬ í›„ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰
                controller.invalidateCache();
                
                // ê°•ì œ ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ (ê°€ëŠ¥í•œ ê²½ìš°)
                if (window.gc) {
                    window.gc();
                }

                const finalMemory = performance.memory ? {
                    used: performance.memory.usedJSHeapSize,
                    total: performance.memory.totalJSHeapSize
                } : null;

                if (initialMemory && midMemory && finalMemory) {
                    const memoryIncrease = ((midMemory.used - initialMemory.used) / 1024 / 1024).toFixed(2);
                    const memoryAfterCleanup = ((finalMemory.used - initialMemory.used) / 1024 / 1024).toFixed(2);

                    results.push(createTestItem(
                        'ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ í…ŒìŠ¤íŠ¸',
                        `ğŸ“Š ë©”ëª¨ë¦¬ ë³€í™”ëŸ‰:\nì´ˆê¸°: ${(initialMemory.used / 1024 / 1024).toFixed(2)}MB\nì—°ì‚° í›„: ${(midMemory.used / 1024 / 1024).toFixed(2)}MB (+${memoryIncrease}MB)\nì •ë¦¬ í›„: ${(finalMemory.used / 1024 / 1024).toFixed(2)}MB (+${memoryAfterCleanup}MB)\n\në©”ëª¨ë¦¬ ì •ë¦¬ íš¨ê³¼: ${memoryIncrease !== memoryAfterCleanup ? 'âœ… íš¨ê³¼ì ' : 'âš ï¸ ì œí•œì '}`,
                        'success'
                    ));
                } else {
                    results.push(createTestItem(
                        'ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ í…ŒìŠ¤íŠ¸',
                        'âš ï¸ performance.memory APIê°€ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\në¸Œë¼ìš°ì €ì—ì„œ ë©”ëª¨ë¦¬ ì •ë³´ë¥¼ ì œê³µí•˜ì§€ ì•ŠìŒ',
                        'warning'
                    ));
                }

                // ë¦¬ì†ŒìŠ¤ ì •ë¦¬ í…ŒìŠ¤íŠ¸
                const cleanupTest = () => {
                    try {
                        controller.cleanup();
                        return true;
                    } catch (error) {
                        throw error;
                    }
                };

                const cleanupResult = cleanupTest();

                results.push(createTestItem(
                    'ë¦¬ì†ŒìŠ¤ ì •ë¦¬ í…ŒìŠ¤íŠ¸',
                    `âœ… cleanup() ë©”ì„œë“œ ì‹¤í–‰ ì„±ê³µ\nì»¨íŠ¸ë¡¤ëŸ¬ ì •ë¦¬ ìƒíƒœ: ${!controller.isInitialized ? 'ì™„ë£Œ' : 'ë¯¸ì™„ë£Œ'}\nanalysisOrchestrator: ${controller.analysisOrchestrator ? 'ì¡´ì¬' : 'ì •ë¦¬ë¨'}`,
                    'success'
                ));

                // ì¬ì´ˆê¸°í™” í…ŒìŠ¤íŠ¸
                await controller.initialize();
                
                results.push(createTestItem(
                    'ì¬ì´ˆê¸°í™” í…ŒìŠ¤íŠ¸',
                    `âœ… ì •ë¦¬ í›„ ì¬ì´ˆê¸°í™” ì„±ê³µ\nì´ˆê¸°í™” ìƒíƒœ: ${controller.isInitialized}\nanalysisOrchestrator: ${controller.analysisOrchestrator ? 'ë³µì›ë¨' : 'ëˆ„ë½'}`,
                    'success'
                ));

            } catch (error) {
                results.push(createTestItem(
                    'ë©”ëª¨ë¦¬ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨',
                    `âŒ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`,
                    'error'
                ));
            }

            updateTestSection('memory-tests', results.join(''));
        }

        // ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        window.runAllTests = async function() {
            window.testState.startTime = performance.now();
            window.testState.results = [];

            // ë²„íŠ¼ ë¹„í™œì„±í™”
            const buttons = document.querySelectorAll('.run-button');
            buttons.forEach(btn => btn.disabled = true);

            try {
                await testModuleLoading();
                await testFunctionality(); 
                await testCompatibility();
                await testMemory();

                // ìš”ì•½ ìƒì„±
                generateSummary();

            } catch (error) {
                console.error('í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜:', error);
            } finally {
                // ë²„íŠ¼ ì¬í™œì„±í™”
                buttons.forEach(btn => btn.disabled = false);
            }
        };

        window.runPerformanceTest = async function() {
            if (!window.testState.controller) {
                alert('ë¨¼ì € ì „ì²´ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ì—¬ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì´ˆê¸°í™”í•˜ì„¸ìš”.');
                return;
            }
            await testPerformance();
        };

        window.runCompatibilityTest = async function() {
            if (!window.testState.controller) {
                alert('ë¨¼ì € ì „ì²´ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ì—¬ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì´ˆê¸°í™”í•˜ì„¸ìš”.');
                return;
            }
            await testCompatibility();
        };

        window.clearResults = function() {
            const sections = ['module-loading-tests', 'functionality-tests', 'performance-tests', 'compatibility-tests', 'memory-tests'];
            sections.forEach(section => {
                document.getElementById(section).innerHTML = `
                    <div class="test-item">
                        <div class="test-name">í…ŒìŠ¤íŠ¸ ì¤€ë¹„ ì¤‘...</div>
                        <div class="test-result">í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ë ¤ë©´ í•´ë‹¹ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</div>
                    </div>
                `;
            });
            
            document.getElementById('performance-metrics').innerHTML = '';
            document.getElementById('test-summary').style.display = 'none';
            window.testState.results = [];
            window.testState.metrics = {};
        };

        function generateSummary() {
            const endTime = performance.now();
            const totalTime = Math.round((endTime - window.testState.startTime) * 100) / 100;

            const testResults = document.querySelectorAll('.test-item');
            let passCount = 0;
            let failCount = 0;
            let warnCount = 0;

            testResults.forEach(item => {
                if (item.classList.contains('success')) passCount++;
                else if (item.classList.contains('error')) failCount++;
                else if (item.classList.contains('warning')) warnCount++;
            });

            const totalTests = passCount + failCount + warnCount;
            const successRate = totalTests > 0 ? Math.round((passCount / totalTests) * 100) : 0;

            const summaryHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 20px;">
                    <div style="text-align: center;">
                        <div style="font-size: 2rem; font-weight: bold; margin-bottom: 5px;">${totalTests}</div>
                        <div>ì´ í…ŒìŠ¤íŠ¸ ìˆ˜</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 2rem; font-weight: bold; color: #48bb78; margin-bottom: 5px;">${passCount}</div>
                        <div>ì„±ê³µ</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 2rem; font-weight: bold; color: #f56565; margin-bottom: 5px;">${failCount}</div>
                        <div>ì‹¤íŒ¨</div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 2rem; font-weight: bold; color: #ed8936; margin-bottom: 5px;">${warnCount}</div>
                        <div>ê²½ê³ </div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 2rem; font-weight: bold; margin-bottom: 5px;">${successRate}%</div>
                        <div>ì„±ê³µë¥ </div>
                    </div>
                    <div style="text-align: center;">
                        <div style="font-size: 2rem; font-weight: bold; margin-bottom: 5px;">${totalTime}ms</div>
                        <div>ì´ ì‹¤í–‰ ì‹œê°„</div>
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <strong>ğŸ¯ Phase 1 ë¦¬íŒ©í† ë§ ê²°ê³¼:</strong><br>
                    ${successRate >= 90 ? 
                        'âœ… ë¦¬íŒ©í† ë§ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ëª¨ë“  ê¸°ëŠ¥ì´ ì •ìƒ ì‘ë™í•˜ë©° ì„±ëŠ¥ì´ í–¥ìƒë˜ì—ˆìŠµë‹ˆë‹¤.' :
                        successRate >= 70 ?
                        'âš ï¸ ë¦¬íŒ©í† ë§ì´ ëŒ€ë¶€ë¶„ ì„±ê³µí–ˆì§€ë§Œ ì¼ë¶€ ê°œì„ ì´ í•„ìš”í•©ë‹ˆë‹¤.' :
                        'âŒ ë¦¬íŒ©í† ë§ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤. ê²€í† ê°€ í•„ìš”í•©ë‹ˆë‹¤.'
                    }
                </div>

                <div style="margin-top: 15px; font-size: 0.9rem; opacity: 0.8;">
                    í…ŒìŠ¤íŠ¸ ì™„ë£Œ ì‹œê°„: ${new Date().toLocaleString('ko-KR')}
                </div>
            `;

            document.getElementById('summary-content').innerHTML = summaryHTML;
            document.getElementById('test-summary').style.display = 'block';
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì•ˆë‚´ ë©”ì‹œì§€
        console.log('ğŸš€ Phase 1 ë¦¬íŒ©í† ë§ í†µí•© í…ŒìŠ¤íŠ¸ê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.');
        console.log('ì „ì²´ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ë ¤ë©´ "ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.');
    </script>
</body>
</html>
