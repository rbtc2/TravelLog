<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>테마 매니저 테스트</title>
    <style>
        /* CSS 변수 정의 */
        :root {
            /* 라이트 모드 기본값 */
            --primary-color: #667eea;
            --white: #ffffff;
            --gray-50: #f8f9fa;
            --gray-100: #f7fafc;
            --gray-200: #edf2f7;
            --gray-300: #e2e8f0;
            --gray-400: #cbd5e0;
            --gray-500: #a0aec0;
            --gray-600: #718096;
            --gray-700: #4a5568;
            --gray-800: #2d3748;
            --gray-900: #1a202c;
            --text-primary: #2d3748;
            --text-secondary: #4a5568;
            --text-muted: #718096;
            --bg-primary: #ffffff;
            --bg-secondary: #f7fafc;
            --success-color: #48bb78;
            --error-color: #e53e3e;
            --warning-color: #fbbf24;
        }
        
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            transition: background-color 0.3s ease, color 0.3s ease;
            color: var(--text-primary, #333333);
        }
        
        .light {
            background-color: var(--bg-primary, #ffffff);
            color: var(--text-primary, #333333);
        }
        
        .dark {
            /* 다크 모드 CSS 변수 */
            --primary-color: #4dabf7;
            --white: #ffffff;
            --gray-50: #1a1a1a;
            --gray-100: #2d3748;
            --gray-200: #4a5568;
            --gray-300: #718096;
            --gray-400: #a0aec0;
            --gray-500: #cbd5e0;
            --gray-600: #e2e8f0;
            --gray-700: #f7fafc;
            --gray-800: #f8f9fa;
            --gray-900: #ffffff;
            --text-primary: #f7fafc;
            --text-secondary: #e2e8f0;
            --text-muted: #a0aec0;
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --success-color: #51cf66;
            --error-color: #ff6b6b;
            --warning-color: #ffd43b;
            
            background-color: var(--bg-primary, #1a1a1a);
            color: var(--text-primary, #ffffff);
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            border: 1px solid var(--gray-300, #ccc);
            border-radius: 8px;
            background: var(--bg-primary, #ffffff);
            color: var(--text-primary, #333333);
        }
        
        h1, h2, h3 {
            color: var(--text-primary, #333);
        }
        
        .dark h1, .dark h2, .dark h3 {
            color: var(--text-primary, #ffffff);
        }
        
        /* 메인 제목 스타일 강화 */
        h1 {
            color: var(--text-primary, #333) !important;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        .dark h1 {
            color: var(--text-primary, #ffffff) !important;
        }
        
        /* 메인 제목에 대한 더 강력한 스타일 */
        .test-container h1 {
            color: var(--text-primary, #333) !important;
            background: transparent !important;
            text-shadow: none !important;
            font-size: 24px !important;
            font-weight: bold !important;
            margin-bottom: 20px !important;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        .dark .test-container h1 {
            color: var(--text-primary, #ffffff) !important;
        }
        
        /* 최고 우선순위 스타일 */
        body .test-container h1 {
            color: #333333 !important;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            font-size: 24px !important;
            font-weight: bold !important;
            margin-bottom: 20px !important;
        }
        
        body.dark .test-container h1 {
            color: #ffffff !important;
        }
        
        /* 절대 우선순위 스타일 */
        html body .test-container h1 {
            color: #333333 !important;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        html body.dark .test-container h1 {
            color: #ffffff !important;
        }
        
        .test-button {
            background: var(--primary-color, #667eea);
            color: var(--white, white);
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .test-button:hover {
            background: var(--primary-dark, #5a67d8);
        }
        
        .test-info {
            background: var(--bg-secondary, #f7fafc);
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            color: var(--text-primary, #333333);
        }
        
        .dark .test-info {
            background: var(--bg-secondary, #2d3748);
            color: var(--text-primary, #ffffff);
        }
        
        /* 이벤트 로그 스타일 */
        #event-log {
            color: var(--text-primary, #333333);
        }
        
        .dark #event-log {
            color: var(--text-primary, #ffffff);
        }
        
        #event-log div {
            background: var(--gray-100, #e2e8f0);
            color: var(--text-primary, #333333);
            margin: 5px 0;
            padding: 5px;
            border-radius: 3px;
        }
        
        .dark #event-log div {
            background: var(--gray-100, #4a5568);
            color: var(--text-primary, #ffffff);
        }
        
        .status {
            font-weight: bold;
            margin: 10px 0;
            color: var(--text-primary, #333333);
        }
        
        .dark .status {
            color: var(--text-primary, #ffffff);
        }
        
        .success {
            color: var(--success-color, #38a169);
        }
        
        .error {
            color: var(--error-color, #e53e3e);
        }
        
        /* 모든 텍스트 요소에 기본 색상 적용 */
        p, div, span, li {
            color: var(--text-primary, #333333);
        }
        
        .dark p, .dark div, .dark span, .dark li {
            color: var(--text-primary, #ffffff);
        }
        
        /* 이벤트 로그 아이템 스타일 */
        .event-log-item {
            background: var(--gray-100, #e2e8f0);
            color: var(--text-primary, #333333);
            margin: 5px 0;
            padding: 5px;
            border-radius: 3px;
        }
        
        .dark .event-log-item {
            background: var(--gray-100, #4a5568);
            color: var(--text-primary, #ffffff);
        }
        
        /* 현재 상태 섹션 스타일 */
        #current-status {
            color: var(--text-primary, #333333);
        }
        
        .dark #current-status {
            color: var(--text-primary, #ffffff);
        }
        
        #theme-info {
            color: var(--text-primary, #333333);
        }
        
        .dark #theme-info {
            color: var(--text-primary, #ffffff);
        }
        
        /* 테마 정보 내부 텍스트 */
        #theme-info br {
            display: block;
            margin: 2px 0;
        }
    </style>
</head>
<body class="light">
    <div class="test-container">
        <h1>🧪 테마 매니저 테스트</h1>
        
        <div class="test-info">
            <h3>현재 상태</h3>
            <div id="current-status" class="status">로딩 중...</div>
            <div id="theme-info">테마 정보를 불러오는 중...</div>
        </div>
        
        <div class="test-info">
            <h3>테마 제어</h3>
            <button class="test-button" onclick="testSetLight()">라이트 모드</button>
            <button class="test-button" onclick="testSetDark()">다크 모드</button>
            <button class="test-button" onclick="testToggle()">토글</button>
            <button class="test-button" onclick="testFollowSystem()">시스템 따르기</button>
            <button class="test-button" onclick="testReset()">초기화</button>
        </div>
        
        <div class="test-info">
            <h3>이벤트 테스트</h3>
            <button class="test-button" onclick="testAddListener()">리스너 추가</button>
            <button class="test-button" onclick="testRemoveListener()">리스너 제거</button>
            <div id="event-log">이벤트 로그가 여기에 표시됩니다...</div>
        </div>
        
        <div class="test-info">
            <h3>스토리지 테스트</h3>
            <button class="test-button" onclick="testStorage()">스토리지 확인</button>
            <button class="test-button" onclick="testClearStorage()">스토리지 초기화</button>
            <div id="storage-info">스토리지 정보가 여기에 표시됩니다...</div>
        </div>
        
        <div class="test-info">
            <h3>CSS 변수 테스트</h3>
            <button class="test-button" onclick="testCSSVariables()">CSS 변수 확인</button>
            <button class="test-button" onclick="testColorPreview()">색상 미리보기</button>
            <div id="css-variables-info">CSS 변수 정보가 여기에 표시됩니다...</div>
            <div id="color-preview" style="margin-top: 10px; padding: 10px; border-radius: 5px; background: var(--bg-secondary, #f8f9fa); color: var(--text-primary, #333333);">
                색상 미리보기: 배경색과 텍스트 색상이 테마에 따라 변경됩니다.
            </div>
        </div>
    </div>

    <script type="module">
        import { themeManager, ThemeUtils } from '../js/modules/utils/theme-manager.js';
        
        // 전역에서 접근 가능하도록 설정
        window.themeManager = themeManager;
        window.ThemeUtils = ThemeUtils;
        
        let eventListenerCount = 0;
        let eventLog = [];
        
        // 초기 상태 표시
        function updateStatus() {
            const status = document.getElementById('current-status');
            const themeInfo = document.getElementById('theme-info');
            const mainTitle = document.querySelector('h1');
            
            const currentTheme = themeManager.getCurrentTheme();
            const info = themeManager.getThemeInfo();
            
            status.textContent = `현재 테마: ${currentTheme}`;
            status.className = `status ${currentTheme === 'dark' ? 'success' : ''}`;
            
            // 테마 정보를 HTML로 생성하여 CSS 변수가 적용되도록 함
            themeInfo.innerHTML = `
                <strong>테마 정보:</strong><br>
                • 현재 테마: ${info.currentTheme}<br>
                • 다크모드: ${info.isDarkMode ? '예' : '아니오'}<br>
                • 라이트모드: ${info.isLightMode ? '예' : '아니오'}<br>
                • 시스템 테마: ${info.isSystemTheme ? '예' : '아니오'}<br>
                • 시스템 다크모드 선호: ${info.systemPrefersDark ? '예' : '아니오'}<br>
                • 리스너 수: ${info.listenersCount}
            `;
            
            // 강제로 색상 업데이트
            status.style.color = '';
            themeInfo.style.color = '';
            if (mainTitle) {
                console.log('updateStatus에서 제목 업데이트:', mainTitle.textContent);
                mainTitle.style.cssText = '';
                mainTitle.style.display = 'block';
                mainTitle.style.visibility = 'visible';
                mainTitle.style.opacity = '1';
                mainTitle.style.fontSize = '24px';
                mainTitle.style.fontWeight = 'bold';
                mainTitle.style.marginBottom = '20px';
                
                const currentTheme = themeManager.getCurrentTheme();
                if (currentTheme === 'dark') {
                    mainTitle.style.color = '#ffffff';
                } else {
                    mainTitle.style.color = '#333333';
                }
                console.log('updateStatus 제목 색상:', mainTitle.style.color);
            }
        }
        
        // 이벤트 로그 업데이트
        function updateEventLog() {
            const eventLogDiv = document.getElementById('event-log');
            eventLogDiv.innerHTML = eventLog.slice(-5).reverse().map(log => 
                `<div class="event-log-item">${log}</div>`
            ).join('');
        }
        
        // 테마 변경 리스너
        function onThemeChange(event) {
            const timestamp = new Date().toLocaleTimeString();
            eventLog.push(`[${timestamp}] 테마 변경: ${event.previousTheme} → ${event.theme} (시스템: ${event.isSystemTheme ? '예' : '아니오'})`);
            updateEventLog();
            
            // 상태 업데이트를 약간 지연시켜 CSS 변수가 완전히 적용되도록 함
            setTimeout(() => {
                updateStatus();
                
                // 제목 색상 강제 업데이트
                const mainTitle = document.querySelector('h1');
                if (mainTitle) {
                    console.log('onThemeChange에서 제목 업데이트:', mainTitle.textContent);
                    mainTitle.style.cssText = '';
                    mainTitle.style.display = 'block';
                    mainTitle.style.visibility = 'visible';
                    mainTitle.style.opacity = '1';
                    mainTitle.style.fontSize = '24px';
                    mainTitle.style.fontWeight = 'bold';
                    mainTitle.style.marginBottom = '20px';
                    
                    const currentTheme = themeManager.getCurrentTheme();
                    if (currentTheme === 'dark') {
                        mainTitle.style.color = '#ffffff';
                    } else {
                        mainTitle.style.color = '#333333';
                    }
                    console.log('onThemeChange 제목 색상:', mainTitle.style.color);
                }
            }, 50);
        }
        
        // 테스트 함수들
        window.testSetLight = () => {
            const result = themeManager.setTheme('light');
            addLog(`라이트 모드 설정: ${result ? '성공' : '실패'}`);
            updateStatus();
        };
        
        window.testSetDark = () => {
            const result = themeManager.setTheme('dark');
            addLog(`다크 모드 설정: ${result ? '성공' : '실패'}`);
            updateStatus();
        };
        
        window.testToggle = () => {
            const result = themeManager.toggleTheme();
            addLog(`테마 토글: ${result ? '성공' : '실패'}`);
            updateStatus();
        };
        
        window.testFollowSystem = () => {
            const result = themeManager.followSystemTheme();
            addLog(`시스템 테마 따르기: ${result ? '성공' : '실패'}`);
            updateStatus();
        };
        
        window.testReset = () => {
            const result = themeManager.resetTheme();
            addLog(`테마 초기화: ${result ? '성공' : '실패'}`);
            updateStatus();
        };
        
        window.testAddListener = () => {
            const removeListener = themeManager.addThemeChangeListener(onThemeChange);
            eventListenerCount++;
            addLog(`리스너 추가됨 (총 ${eventListenerCount}개)`);
            
            // 제거 함수를 저장 (실제로는 사용하지 않음)
            window.removeThemeListener = removeListener;
        };
        
        window.testRemoveListener = () => {
            if (window.removeThemeListener) {
                window.removeThemeListener();
                eventListenerCount--;
                addLog(`리스너 제거됨 (총 ${eventListenerCount}개)`);
                window.removeThemeListener = null;
            } else {
                addLog('제거할 리스너가 없습니다.');
            }
        };
        
        window.testStorage = () => {
            const storageInfo = document.getElementById('storage-info');
            const theme = localStorage.getItem('travelLog_theme');
            const hasTheme = theme !== null;
            
            storageInfo.innerHTML = `
                <strong>스토리지 정보:</strong><br>
                • 테마 설정 존재: ${hasTheme ? '예' : '아니오'}<br>
                • 저장된 테마: ${theme || '없음'}<br>
                • 전체 스토리지 키: ${Object.keys(localStorage).filter(k => k.includes('travelLog')).join(', ') || '없음'}
            `;
        };
        
        window.testClearStorage = () => {
            localStorage.removeItem('travelLog_theme');
            addLog('테마 스토리지 초기화됨');
            window.testStorage();
        };
        
        window.testCSSVariables = () => {
            const cssVariablesInfo = document.getElementById('css-variables-info');
            const computedStyle = getComputedStyle(document.documentElement);
            
            const variables = [
                '--bg-primary',
                '--bg-secondary', 
                '--text-primary',
                '--text-secondary',
                '--primary-color',
                '--success-color',
                '--error-color',
                '--warning-color'
            ];
            
            let info = '<strong>CSS 변수 값:</strong><br>';
            variables.forEach(variable => {
                const value = computedStyle.getPropertyValue(variable).trim();
                info += `• ${variable}: ${value || '정의되지 않음'}<br>`;
            });
            
            cssVariablesInfo.innerHTML = info;
            addLog('CSS 변수 정보 업데이트됨');
        };
        
        window.testColorPreview = () => {
            const colorPreview = document.getElementById('color-preview');
            const currentTheme = themeManager.getCurrentTheme();
            
            colorPreview.innerHTML = `
                <strong>색상 미리보기 (${currentTheme} 모드)</strong><br>
                • 배경색: var(--bg-secondary)<br>
                • 텍스트색: var(--text-primary)<br>
                • 테마에 따라 자동으로 변경됩니다.
            `;
            addLog('색상 미리보기 업데이트됨');
        };
        
        function addLog(message) {
            const timestamp = new Date().toLocaleTimeString();
            eventLog.push(`[${timestamp}] ${message}`);
            updateEventLog();
        }
        
        // 초기화
        updateStatus();
        window.testStorage();
        window.testCSSVariables();
        window.testColorPreview();
        
        // 메인 제목 강제 표시
        setTimeout(() => {
            const mainTitle = document.querySelector('h1');
            if (mainTitle) {
                console.log('제목 요소 발견:', mainTitle);
                console.log('제목 텍스트:', mainTitle.textContent);
                console.log('현재 스타일:', window.getComputedStyle(mainTitle).color);
                
                // 모든 스타일 초기화
                mainTitle.style.cssText = '';
                
                // 강제로 스타일 적용
                mainTitle.style.display = 'block';
                mainTitle.style.visibility = 'visible';
                mainTitle.style.opacity = '1';
                mainTitle.style.fontSize = '24px';
                mainTitle.style.fontWeight = 'bold';
                mainTitle.style.marginBottom = '20px';
                
                const currentTheme = themeManager.getCurrentTheme();
                if (currentTheme === 'dark') {
                    mainTitle.style.color = '#ffffff';
                } else {
                    mainTitle.style.color = '#333333';
                }
                
                console.log('제목 색상 설정 후:', mainTitle.style.color);
            } else {
                console.error('제목 요소를 찾을 수 없습니다!');
            }
        }, 100);
        
        // 자동 리스너 추가 (테스트용)
        window.testAddListener();
        
        console.log('테마 매니저 테스트 페이지가 로드되었습니다.');
        console.log('테마 매니저:', themeManager);
        console.log('테마 유틸리티:', ThemeUtils);
    </script>
</body>
</html>
