<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í…Œë§ˆ ë§¤ë‹ˆì € í…ŒìŠ¤íŠ¸</title>
    <style>
        /* CSS ë³€ìˆ˜ ì •ì˜ */
        :root {
            /* ë¼ì´íŠ¸ ëª¨ë“œ ê¸°ë³¸ê°’ */
            --primary-color: #667eea;
            --white: #ffffff;
            --gray-50: #f8f9fa;
            --gray-100: #f7fafc;
            --gray-200: #edf2f7;
            --gray-300: #e2e8f0;
            --gray-400: #cbd5e0;
            --gray-500: #a0aec0;
            --gray-600: #718096;
            --gray-700: #4a5568;
            --gray-800: #2d3748;
            --gray-900: #1a202c;
            --text-primary: #2d3748;
            --text-secondary: #4a5568;
            --text-muted: #718096;
            --bg-primary: #ffffff;
            --bg-secondary: #f7fafc;
            --success-color: #48bb78;
            --error-color: #e53e3e;
            --warning-color: #fbbf24;
        }
        
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            transition: background-color 0.3s ease, color 0.3s ease;
            color: var(--text-primary, #333333);
        }
        
        .light {
            background-color: var(--bg-primary, #ffffff);
            color: var(--text-primary, #333333);
        }
        
        .dark {
            /* ë‹¤í¬ ëª¨ë“œ CSS ë³€ìˆ˜ */
            --primary-color: #4dabf7;
            --white: #ffffff;
            --gray-50: #1a1a1a;
            --gray-100: #2d3748;
            --gray-200: #4a5568;
            --gray-300: #718096;
            --gray-400: #a0aec0;
            --gray-500: #cbd5e0;
            --gray-600: #e2e8f0;
            --gray-700: #f7fafc;
            --gray-800: #f8f9fa;
            --gray-900: #ffffff;
            --text-primary: #f7fafc;
            --text-secondary: #e2e8f0;
            --text-muted: #a0aec0;
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --success-color: #51cf66;
            --error-color: #ff6b6b;
            --warning-color: #ffd43b;
            
            background-color: var(--bg-primary, #1a1a1a);
            color: var(--text-primary, #ffffff);
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            border: 1px solid var(--gray-300, #ccc);
            border-radius: 8px;
            background: var(--bg-primary, #ffffff);
            color: var(--text-primary, #333333);
        }
        
        h1, h2, h3 {
            color: var(--text-primary, #333);
        }
        
        .dark h1, .dark h2, .dark h3 {
            color: var(--text-primary, #ffffff);
        }
        
        /* ë©”ì¸ ì œëª© ìŠ¤íƒ€ì¼ ê°•í™” */
        h1 {
            color: var(--text-primary, #333) !important;
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        .dark h1 {
            color: var(--text-primary, #ffffff) !important;
        }
        
        /* ë©”ì¸ ì œëª©ì— ëŒ€í•œ ë” ê°•ë ¥í•œ ìŠ¤íƒ€ì¼ */
        .test-container h1 {
            color: var(--text-primary, #333) !important;
            background: transparent !important;
            text-shadow: none !important;
            font-size: 24px !important;
            font-weight: bold !important;
            margin-bottom: 20px !important;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        .dark .test-container h1 {
            color: var(--text-primary, #ffffff) !important;
        }
        
        /* ìµœê³  ìš°ì„ ìˆœìœ„ ìŠ¤íƒ€ì¼ */
        body .test-container h1 {
            color: #333333 !important;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            font-size: 24px !important;
            font-weight: bold !important;
            margin-bottom: 20px !important;
        }
        
        body.dark .test-container h1 {
            color: #ffffff !important;
        }
        
        /* ì ˆëŒ€ ìš°ì„ ìˆœìœ„ ìŠ¤íƒ€ì¼ */
        html body .test-container h1 {
            color: #333333 !important;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        html body.dark .test-container h1 {
            color: #ffffff !important;
        }
        
        .test-button {
            background: var(--primary-color, #667eea);
            color: var(--white, white);
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .test-button:hover {
            background: var(--primary-dark, #5a67d8);
        }
        
        .test-info {
            background: var(--bg-secondary, #f7fafc);
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            color: var(--text-primary, #333333);
        }
        
        .dark .test-info {
            background: var(--bg-secondary, #2d3748);
            color: var(--text-primary, #ffffff);
        }
        
        /* ì´ë²¤íŠ¸ ë¡œê·¸ ìŠ¤íƒ€ì¼ */
        #event-log {
            color: var(--text-primary, #333333);
        }
        
        .dark #event-log {
            color: var(--text-primary, #ffffff);
        }
        
        #event-log div {
            background: var(--gray-100, #e2e8f0);
            color: var(--text-primary, #333333);
            margin: 5px 0;
            padding: 5px;
            border-radius: 3px;
        }
        
        .dark #event-log div {
            background: var(--gray-100, #4a5568);
            color: var(--text-primary, #ffffff);
        }
        
        .status {
            font-weight: bold;
            margin: 10px 0;
            color: var(--text-primary, #333333);
        }
        
        .dark .status {
            color: var(--text-primary, #ffffff);
        }
        
        .success {
            color: var(--success-color, #38a169);
        }
        
        .error {
            color: var(--error-color, #e53e3e);
        }
        
        /* ëª¨ë“  í…ìŠ¤íŠ¸ ìš”ì†Œì— ê¸°ë³¸ ìƒ‰ìƒ ì ìš© */
        p, div, span, li {
            color: var(--text-primary, #333333);
        }
        
        .dark p, .dark div, .dark span, .dark li {
            color: var(--text-primary, #ffffff);
        }
        
        /* ì´ë²¤íŠ¸ ë¡œê·¸ ì•„ì´í…œ ìŠ¤íƒ€ì¼ */
        .event-log-item {
            background: var(--gray-100, #e2e8f0);
            color: var(--text-primary, #333333);
            margin: 5px 0;
            padding: 5px;
            border-radius: 3px;
        }
        
        .dark .event-log-item {
            background: var(--gray-100, #4a5568);
            color: var(--text-primary, #ffffff);
        }
        
        /* í˜„ì¬ ìƒíƒœ ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
        #current-status {
            color: var(--text-primary, #333333);
        }
        
        .dark #current-status {
            color: var(--text-primary, #ffffff);
        }
        
        #theme-info {
            color: var(--text-primary, #333333);
        }
        
        .dark #theme-info {
            color: var(--text-primary, #ffffff);
        }
        
        /* í…Œë§ˆ ì •ë³´ ë‚´ë¶€ í…ìŠ¤íŠ¸ */
        #theme-info br {
            display: block;
            margin: 2px 0;
        }
    </style>
</head>
<body class="light">
    <div class="test-container">
        <h1>ğŸ§ª í…Œë§ˆ ë§¤ë‹ˆì € í…ŒìŠ¤íŠ¸</h1>
        
        <div class="test-info">
            <h3>í˜„ì¬ ìƒíƒœ</h3>
            <div id="current-status" class="status">ë¡œë”© ì¤‘...</div>
            <div id="theme-info">í…Œë§ˆ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        </div>
        
        <div class="test-info">
            <h3>í…Œë§ˆ ì œì–´</h3>
            <button class="test-button" onclick="testSetLight()">ë¼ì´íŠ¸ ëª¨ë“œ</button>
            <button class="test-button" onclick="testSetDark()">ë‹¤í¬ ëª¨ë“œ</button>
            <button class="test-button" onclick="testToggle()">í† ê¸€</button>
            <button class="test-button" onclick="testFollowSystem()">ì‹œìŠ¤í…œ ë”°ë¥´ê¸°</button>
            <button class="test-button" onclick="testReset()">ì´ˆê¸°í™”</button>
        </div>
        
        <div class="test-info">
            <h3>ì´ë²¤íŠ¸ í…ŒìŠ¤íŠ¸</h3>
            <button class="test-button" onclick="testAddListener()">ë¦¬ìŠ¤ë„ˆ ì¶”ê°€</button>
            <button class="test-button" onclick="testRemoveListener()">ë¦¬ìŠ¤ë„ˆ ì œê±°</button>
            <div id="event-log">ì´ë²¤íŠ¸ ë¡œê·¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>
        </div>
        
        <div class="test-info">
            <h3>ìŠ¤í† ë¦¬ì§€ í…ŒìŠ¤íŠ¸</h3>
            <button class="test-button" onclick="testStorage()">ìŠ¤í† ë¦¬ì§€ í™•ì¸</button>
            <button class="test-button" onclick="testClearStorage()">ìŠ¤í† ë¦¬ì§€ ì´ˆê¸°í™”</button>
            <div id="storage-info">ìŠ¤í† ë¦¬ì§€ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>
        </div>
        
        <div class="test-info">
            <h3>CSS ë³€ìˆ˜ í…ŒìŠ¤íŠ¸</h3>
            <button class="test-button" onclick="testCSSVariables()">CSS ë³€ìˆ˜ í™•ì¸</button>
            <button class="test-button" onclick="testColorPreview()">ìƒ‰ìƒ ë¯¸ë¦¬ë³´ê¸°</button>
            <div id="css-variables-info">CSS ë³€ìˆ˜ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</div>
            <div id="color-preview" style="margin-top: 10px; padding: 10px; border-radius: 5px; background: var(--bg-secondary, #f8f9fa); color: var(--text-primary, #333333);">
                ìƒ‰ìƒ ë¯¸ë¦¬ë³´ê¸°: ë°°ê²½ìƒ‰ê³¼ í…ìŠ¤íŠ¸ ìƒ‰ìƒì´ í…Œë§ˆì— ë”°ë¼ ë³€ê²½ë©ë‹ˆë‹¤.
            </div>
        </div>
    </div>

    <script type="module">
        import { themeManager, ThemeUtils } from '../js/modules/utils/theme-manager.js';
        
        // ì „ì—­ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •
        window.themeManager = themeManager;
        window.ThemeUtils = ThemeUtils;
        
        let eventListenerCount = 0;
        let eventLog = [];
        
        // ì´ˆê¸° ìƒíƒœ í‘œì‹œ
        function updateStatus() {
            const status = document.getElementById('current-status');
            const themeInfo = document.getElementById('theme-info');
            const mainTitle = document.querySelector('h1');
            
            const currentTheme = themeManager.getCurrentTheme();
            const info = themeManager.getThemeInfo();
            
            status.textContent = `í˜„ì¬ í…Œë§ˆ: ${currentTheme}`;
            status.className = `status ${currentTheme === 'dark' ? 'success' : ''}`;
            
            // í…Œë§ˆ ì •ë³´ë¥¼ HTMLë¡œ ìƒì„±í•˜ì—¬ CSS ë³€ìˆ˜ê°€ ì ìš©ë˜ë„ë¡ í•¨
            themeInfo.innerHTML = `
                <strong>í…Œë§ˆ ì •ë³´:</strong><br>
                â€¢ í˜„ì¬ í…Œë§ˆ: ${info.currentTheme}<br>
                â€¢ ë‹¤í¬ëª¨ë“œ: ${info.isDarkMode ? 'ì˜ˆ' : 'ì•„ë‹ˆì˜¤'}<br>
                â€¢ ë¼ì´íŠ¸ëª¨ë“œ: ${info.isLightMode ? 'ì˜ˆ' : 'ì•„ë‹ˆì˜¤'}<br>
                â€¢ ì‹œìŠ¤í…œ í…Œë§ˆ: ${info.isSystemTheme ? 'ì˜ˆ' : 'ì•„ë‹ˆì˜¤'}<br>
                â€¢ ì‹œìŠ¤í…œ ë‹¤í¬ëª¨ë“œ ì„ í˜¸: ${info.systemPrefersDark ? 'ì˜ˆ' : 'ì•„ë‹ˆì˜¤'}<br>
                â€¢ ë¦¬ìŠ¤ë„ˆ ìˆ˜: ${info.listenersCount}
            `;
            
            // ê°•ì œë¡œ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
            status.style.color = '';
            themeInfo.style.color = '';
            if (mainTitle) {
                console.log('updateStatusì—ì„œ ì œëª© ì—…ë°ì´íŠ¸:', mainTitle.textContent);
                mainTitle.style.cssText = '';
                mainTitle.style.display = 'block';
                mainTitle.style.visibility = 'visible';
                mainTitle.style.opacity = '1';
                mainTitle.style.fontSize = '24px';
                mainTitle.style.fontWeight = 'bold';
                mainTitle.style.marginBottom = '20px';
                
                const currentTheme = themeManager.getCurrentTheme();
                if (currentTheme === 'dark') {
                    mainTitle.style.color = '#ffffff';
                } else {
                    mainTitle.style.color = '#333333';
                }
                console.log('updateStatus ì œëª© ìƒ‰ìƒ:', mainTitle.style.color);
            }
        }
        
        // ì´ë²¤íŠ¸ ë¡œê·¸ ì—…ë°ì´íŠ¸
        function updateEventLog() {
            const eventLogDiv = document.getElementById('event-log');
            eventLogDiv.innerHTML = eventLog.slice(-5).reverse().map(log => 
                `<div class="event-log-item">${log}</div>`
            ).join('');
        }
        
        // í…Œë§ˆ ë³€ê²½ ë¦¬ìŠ¤ë„ˆ
        function onThemeChange(event) {
            const timestamp = new Date().toLocaleTimeString();
            eventLog.push(`[${timestamp}] í…Œë§ˆ ë³€ê²½: ${event.previousTheme} â†’ ${event.theme} (ì‹œìŠ¤í…œ: ${event.isSystemTheme ? 'ì˜ˆ' : 'ì•„ë‹ˆì˜¤'})`);
            updateEventLog();
            
            // ìƒíƒœ ì—…ë°ì´íŠ¸ë¥¼ ì•½ê°„ ì§€ì—°ì‹œì¼œ CSS ë³€ìˆ˜ê°€ ì™„ì „íˆ ì ìš©ë˜ë„ë¡ í•¨
            setTimeout(() => {
                updateStatus();
                
                // ì œëª© ìƒ‰ìƒ ê°•ì œ ì—…ë°ì´íŠ¸
                const mainTitle = document.querySelector('h1');
                if (mainTitle) {
                    console.log('onThemeChangeì—ì„œ ì œëª© ì—…ë°ì´íŠ¸:', mainTitle.textContent);
                    mainTitle.style.cssText = '';
                    mainTitle.style.display = 'block';
                    mainTitle.style.visibility = 'visible';
                    mainTitle.style.opacity = '1';
                    mainTitle.style.fontSize = '24px';
                    mainTitle.style.fontWeight = 'bold';
                    mainTitle.style.marginBottom = '20px';
                    
                    const currentTheme = themeManager.getCurrentTheme();
                    if (currentTheme === 'dark') {
                        mainTitle.style.color = '#ffffff';
                    } else {
                        mainTitle.style.color = '#333333';
                    }
                    console.log('onThemeChange ì œëª© ìƒ‰ìƒ:', mainTitle.style.color);
                }
            }, 50);
        }
        
        // í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤
        window.testSetLight = () => {
            const result = themeManager.setTheme('light');
            addLog(`ë¼ì´íŠ¸ ëª¨ë“œ ì„¤ì •: ${result ? 'ì„±ê³µ' : 'ì‹¤íŒ¨'}`);
            updateStatus();
        };
        
        window.testSetDark = () => {
            const result = themeManager.setTheme('dark');
            addLog(`ë‹¤í¬ ëª¨ë“œ ì„¤ì •: ${result ? 'ì„±ê³µ' : 'ì‹¤íŒ¨'}`);
            updateStatus();
        };
        
        window.testToggle = () => {
            const result = themeManager.toggleTheme();
            addLog(`í…Œë§ˆ í† ê¸€: ${result ? 'ì„±ê³µ' : 'ì‹¤íŒ¨'}`);
            updateStatus();
        };
        
        window.testFollowSystem = () => {
            const result = themeManager.followSystemTheme();
            addLog(`ì‹œìŠ¤í…œ í…Œë§ˆ ë”°ë¥´ê¸°: ${result ? 'ì„±ê³µ' : 'ì‹¤íŒ¨'}`);
            updateStatus();
        };
        
        window.testReset = () => {
            const result = themeManager.resetTheme();
            addLog(`í…Œë§ˆ ì´ˆê¸°í™”: ${result ? 'ì„±ê³µ' : 'ì‹¤íŒ¨'}`);
            updateStatus();
        };
        
        window.testAddListener = () => {
            const removeListener = themeManager.addThemeChangeListener(onThemeChange);
            eventListenerCount++;
            addLog(`ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ë¨ (ì´ ${eventListenerCount}ê°œ)`);
            
            // ì œê±° í•¨ìˆ˜ë¥¼ ì €ì¥ (ì‹¤ì œë¡œëŠ” ì‚¬ìš©í•˜ì§€ ì•ŠìŒ)
            window.removeThemeListener = removeListener;
        };
        
        window.testRemoveListener = () => {
            if (window.removeThemeListener) {
                window.removeThemeListener();
                eventListenerCount--;
                addLog(`ë¦¬ìŠ¤ë„ˆ ì œê±°ë¨ (ì´ ${eventListenerCount}ê°œ)`);
                window.removeThemeListener = null;
            } else {
                addLog('ì œê±°í•  ë¦¬ìŠ¤ë„ˆê°€ ì—†ìŠµë‹ˆë‹¤.');
            }
        };
        
        window.testStorage = () => {
            const storageInfo = document.getElementById('storage-info');
            const theme = localStorage.getItem('travelLog_theme');
            const hasTheme = theme !== null;
            
            storageInfo.innerHTML = `
                <strong>ìŠ¤í† ë¦¬ì§€ ì •ë³´:</strong><br>
                â€¢ í…Œë§ˆ ì„¤ì • ì¡´ì¬: ${hasTheme ? 'ì˜ˆ' : 'ì•„ë‹ˆì˜¤'}<br>
                â€¢ ì €ì¥ëœ í…Œë§ˆ: ${theme || 'ì—†ìŒ'}<br>
                â€¢ ì „ì²´ ìŠ¤í† ë¦¬ì§€ í‚¤: ${Object.keys(localStorage).filter(k => k.includes('travelLog')).join(', ') || 'ì—†ìŒ'}
            `;
        };
        
        window.testClearStorage = () => {
            localStorage.removeItem('travelLog_theme');
            addLog('í…Œë§ˆ ìŠ¤í† ë¦¬ì§€ ì´ˆê¸°í™”ë¨');
            window.testStorage();
        };
        
        window.testCSSVariables = () => {
            const cssVariablesInfo = document.getElementById('css-variables-info');
            const computedStyle = getComputedStyle(document.documentElement);
            
            const variables = [
                '--bg-primary',
                '--bg-secondary', 
                '--text-primary',
                '--text-secondary',
                '--primary-color',
                '--success-color',
                '--error-color',
                '--warning-color'
            ];
            
            let info = '<strong>CSS ë³€ìˆ˜ ê°’:</strong><br>';
            variables.forEach(variable => {
                const value = computedStyle.getPropertyValue(variable).trim();
                info += `â€¢ ${variable}: ${value || 'ì •ì˜ë˜ì§€ ì•ŠìŒ'}<br>`;
            });
            
            cssVariablesInfo.innerHTML = info;
            addLog('CSS ë³€ìˆ˜ ì •ë³´ ì—…ë°ì´íŠ¸ë¨');
        };
        
        window.testColorPreview = () => {
            const colorPreview = document.getElementById('color-preview');
            const currentTheme = themeManager.getCurrentTheme();
            
            colorPreview.innerHTML = `
                <strong>ìƒ‰ìƒ ë¯¸ë¦¬ë³´ê¸° (${currentTheme} ëª¨ë“œ)</strong><br>
                â€¢ ë°°ê²½ìƒ‰: var(--bg-secondary)<br>
                â€¢ í…ìŠ¤íŠ¸ìƒ‰: var(--text-primary)<br>
                â€¢ í…Œë§ˆì— ë”°ë¼ ìë™ìœ¼ë¡œ ë³€ê²½ë©ë‹ˆë‹¤.
            `;
            addLog('ìƒ‰ìƒ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸ë¨');
        };
        
        function addLog(message) {
            const timestamp = new Date().toLocaleTimeString();
            eventLog.push(`[${timestamp}] ${message}`);
            updateEventLog();
        }
        
        // ì´ˆê¸°í™”
        updateStatus();
        window.testStorage();
        window.testCSSVariables();
        window.testColorPreview();
        
        // ë©”ì¸ ì œëª© ê°•ì œ í‘œì‹œ
        setTimeout(() => {
            const mainTitle = document.querySelector('h1');
            if (mainTitle) {
                console.log('ì œëª© ìš”ì†Œ ë°œê²¬:', mainTitle);
                console.log('ì œëª© í…ìŠ¤íŠ¸:', mainTitle.textContent);
                console.log('í˜„ì¬ ìŠ¤íƒ€ì¼:', window.getComputedStyle(mainTitle).color);
                
                // ëª¨ë“  ìŠ¤íƒ€ì¼ ì´ˆê¸°í™”
                mainTitle.style.cssText = '';
                
                // ê°•ì œë¡œ ìŠ¤íƒ€ì¼ ì ìš©
                mainTitle.style.display = 'block';
                mainTitle.style.visibility = 'visible';
                mainTitle.style.opacity = '1';
                mainTitle.style.fontSize = '24px';
                mainTitle.style.fontWeight = 'bold';
                mainTitle.style.marginBottom = '20px';
                
                const currentTheme = themeManager.getCurrentTheme();
                if (currentTheme === 'dark') {
                    mainTitle.style.color = '#ffffff';
                } else {
                    mainTitle.style.color = '#333333';
                }
                
                console.log('ì œëª© ìƒ‰ìƒ ì„¤ì • í›„:', mainTitle.style.color);
            } else {
                console.error('ì œëª© ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!');
            }
        }, 100);
        
        // ìë™ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ (í…ŒìŠ¤íŠ¸ìš©)
        window.testAddListener();
        
        console.log('í…Œë§ˆ ë§¤ë‹ˆì € í…ŒìŠ¤íŠ¸ í˜ì´ì§€ê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
        console.log('í…Œë§ˆ ë§¤ë‹ˆì €:', themeManager);
        console.log('í…Œë§ˆ ìœ í‹¸ë¦¬í‹°:', ThemeUtils);
    </script>
</body>
</html>
