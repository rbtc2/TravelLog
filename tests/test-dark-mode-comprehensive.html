<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>다크모드 종합 테스트 도구</title>
    <link rel="stylesheet" href="../styles/main.css">
    <style>
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: var(--bg-secondary, #f8f9fa);
            border-radius: 12px;
            border: 2px solid var(--gray-200, #e2e8f0);
        }
        
        .test-title {
            font-size: 2rem;
            font-weight: bold;
            color: var(--text-primary, #2d3748);
            margin-bottom: 10px;
        }
        
        .test-subtitle {
            color: var(--text-secondary, #718096);
            font-size: 1.1rem;
        }
        
        .test-controls {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }
        
        .test-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--primary-color, #667eea);
            color: white;
        }
        
        .test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .test-btn.secondary {
            background: var(--gray-200, #e2e8f0);
            color: var(--text-primary, #2d3748);
        }
        
        .test-btn.danger {
            background: var(--error-color, #e53e3e);
        }
        
        .test-sections {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .test-section {
            background: var(--white, #ffffff);
            border: 1px solid var(--gray-200, #e2e8f0);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .test-section h3 {
            color: var(--text-primary, #2d3748);
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .test-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--gray-100, #f7fafc);
        }
        
        .test-item:last-child {
            border-bottom: none;
        }
        
        .test-item-label {
            color: var(--text-secondary, #718096);
            font-size: 14px;
        }
        
        .test-item-value {
            color: var(--text-primary, #2d3748);
            font-weight: 600;
            font-size: 14px;
        }
        
        .test-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .test-status.pass {
            background: #c6f6d5;
            color: #22543d;
        }
        
        .test-status.fail {
            background: #fed7d7;
            color: #c53030;
        }
        
        .test-status.warning {
            background: #fef5e7;
            color: #744210;
        }
        
        .test-results {
            background: var(--bg-secondary, #f8f9fa);
            border: 1px solid var(--gray-200, #e2e8f0);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .test-results h3 {
            color: var(--text-primary, #2d3748);
            margin-bottom: 15px;
        }
        
        .test-log {
            background: var(--white, #ffffff);
            border: 1px solid var(--gray-200, #e2e8f0);
            border-radius: 8px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.4;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }
        
        .log-entry.success {
            color: #22543d;
        }
        
        .log-entry.error {
            color: #c53030;
        }
        
        .log-entry.warning {
            color: #744210;
        }
        
        .log-entry.info {
            color: var(--text-secondary, #718096);
        }
        
        /* 다크모드 스타일 */
        .dark .test-header {
            background: var(--bg-secondary, #2d2d2d);
            border-color: var(--gray-400, #718096);
        }
        
        .dark .test-section {
            background: var(--bg-secondary, #2d2d2d);
            border-color: var(--gray-400, #718096);
        }
        
        .dark .test-results {
            background: var(--bg-secondary, #2d2d2d);
            border-color: var(--gray-400, #718096);
        }
        
        .dark .test-log {
            background: var(--bg-primary, #1a1a1a);
            border-color: var(--gray-400, #718096);
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1 class="test-title">🌙 다크모드 종합 테스트 도구</h1>
            <p class="test-subtitle">TravelLog 다크모드 기능의 모든 측면을 테스트합니다</p>
        </div>
        
        <div class="test-controls">
            <button class="test-btn" onclick="runAllTests()">전체 테스트 실행</button>
            <button class="test-btn secondary" onclick="testThemeManager()">테마 매니저 테스트</button>
            <button class="test-btn secondary" onclick="testCSSVariables()">CSS 변수 테스트</button>
            <button class="test-btn secondary" onclick="testAnimations()">애니메이션 테스트</button>
            <button class="test-btn danger" onclick="clearResults()">결과 초기화</button>
        </div>
        
        <div class="test-sections">
            <div class="test-section">
                <h3>🎨 테마 상태</h3>
                <div class="test-item">
                    <span class="test-item-label">현재 테마</span>
                    <span class="test-item-value" id="current-theme">-</span>
                </div>
                <div class="test-item">
                    <span class="test-item-label">시스템 테마 감지</span>
                    <span class="test-item-value" id="system-theme">-</span>
                </div>
                <div class="test-item">
                    <span class="test-item-label">저장된 설정</span>
                    <span class="test-item-value" id="saved-theme">-</span>
                </div>
                <div class="test-item">
                    <span class="test-item-label">애니메이션 지원</span>
                    <span class="test-item-value" id="animation-support">-</span>
                </div>
            </div>
            
            <div class="test-section">
                <h3>🔧 CSS 변수</h3>
                <div class="test-item">
                    <span class="test-item-label">다크모드 변수</span>
                    <span class="test-item-value" id="dark-variables">-</span>
                </div>
                <div class="test-item">
                    <span class="test-item-label">라이트모드 변수</span>
                    <span class="test-item-value" id="light-variables">-</span>
                </div>
                <div class="test-item">
                    <span class="test-item-label">폴백 값</span>
                    <span class="test-item-value" id="fallback-values">-</span>
                </div>
                <div class="test-item">
                    <span class="test-item-label">호환성</span>
                    <span class="test-item-value" id="css-compatibility">-</span>
                </div>
            </div>
            
            <div class="test-section">
                <h3>⚡ 성능</h3>
                <div class="test-item">
                    <span class="test-item-label">전환 속도</span>
                    <span class="test-item-value" id="transition-speed">-</span>
                </div>
                <div class="test-item">
                    <span class="test-item-label">메모리 사용량</span>
                    <span class="test-item-value" id="memory-usage">-</span>
                </div>
                <div class="test-item">
                    <span class="test-item-label">GPU 가속</span>
                    <span class="test-item-value" id="gpu-acceleration">-</span>
                </div>
                <div class="test-item">
                    <span class="test-item-label">접근성</span>
                    <span class="test-item-value" id="accessibility">-</span>
                </div>
            </div>
            
            <div class="test-section">
                <h3>📱 페이지별 테스트</h3>
                <div class="test-item">
                    <span class="test-item-label">홈 페이지</span>
                    <span class="test-item-value" id="home-page">-</span>
                </div>
                <div class="test-item">
                    <span class="test-item-label">검색 페이지</span>
                    <span class="test-item-value" id="search-page">-</span>
                </div>
                <div class="test-item">
                    <span class="test-item-label">캘린더 페이지</span>
                    <span class="test-item-value" id="calendar-page">-</span>
                </div>
                <div class="test-item">
                    <span class="test-item-label">나의 로그</span>
                    <span class="test-item-value" id="my-logs-page">-</span>
                </div>
            </div>
        </div>
        
        <div class="test-results">
            <h3>📊 테스트 결과</h3>
            <div class="test-log" id="test-log">
                <div class="log-entry info">테스트 도구가 준비되었습니다. 위의 버튼을 클릭하여 테스트를 시작하세요.</div>
            </div>
        </div>
    </div>

    <script type="module">
        // 테마 매니저 임포트
        import { ThemeManager } from '../js/modules/utils/theme-manager.js';
        
        let themeManager;
        let testResults = [];
        
        // 초기화
        document.addEventListener('DOMContentLoaded', () => {
            try {
                themeManager = new ThemeManager();
                logMessage('info', '테마 매니저가 성공적으로 초기화되었습니다.');
                updateStatus();
            } catch (error) {
                logMessage('error', `테마 매니저 초기화 실패: ${error.message}`);
            }
        });
        
        // 로그 메시지 추가
        function logMessage(type, message) {
            const log = document.getElementById('test-log');
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${timestamp}] ${message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }
        
        // 상태 업데이트
        function updateStatus() {
            if (!themeManager) return;
            
            document.getElementById('current-theme').textContent = themeManager.getCurrentTheme();
            document.getElementById('system-theme').textContent = 
                window.matchMedia('(prefers-color-scheme: dark)').matches ? '다크' : '라이트';
            document.getElementById('saved-theme').textContent = 
                localStorage.getItem('travelLog_theme') || '없음';
            document.getElementById('animation-support').textContent = 
                CSS.supports('transition', 'all 0.3s ease') ? '지원' : '미지원';
        }
        
        // 전체 테스트 실행
        window.runAllTests = async function() {
            logMessage('info', '전체 테스트를 시작합니다...');
            clearResults();
            
            await testThemeManager();
            await testCSSVariables();
            await testAnimations();
            await testPages();
            
            logMessage('success', '전체 테스트가 완료되었습니다.');
        };
        
        // 테마 매니저 테스트
        window.testThemeManager = async function() {
            logMessage('info', '테마 매니저 테스트를 시작합니다...');
            
            try {
                // 기본 기능 테스트
                const originalTheme = themeManager.getCurrentTheme();
                
                // 다크모드 전환 테스트
                themeManager.setTheme('dark', true, false);
                await new Promise(resolve => setTimeout(resolve, 100));
                const darkTheme = themeManager.getCurrentTheme();
                
                // 라이트모드 전환 테스트
                themeManager.setTheme('light', true, false);
                await new Promise(resolve => setTimeout(resolve, 100));
                const lightTheme = themeManager.getCurrentTheme();
                
                // 원래 테마로 복원
                themeManager.setTheme(originalTheme, true, false);
                
                // 결과 검증
                const themeTestPass = darkTheme === 'dark' && lightTheme === 'light';
                document.getElementById('current-theme').textContent = themeManager.getCurrentTheme();
                
                if (themeTestPass) {
                    logMessage('success', '테마 매니저 기본 기능 테스트 통과');
                } else {
                    logMessage('error', '테마 매니저 기본 기능 테스트 실패');
                }
                
                // 이벤트 리스너 테스트
                let eventReceived = false;
                const testListener = () => { eventReceived = true; };
                themeManager.addThemeChangeListener(testListener);
                themeManager.setTheme('dark', true, false);
                await new Promise(resolve => setTimeout(resolve, 50));
                
                if (eventReceived) {
                    logMessage('success', '테마 변경 이벤트 테스트 통과');
                } else {
                    logMessage('error', '테마 변경 이벤트 테스트 실패');
                }
                
                themeManager.removeThemeChangeListener(testListener);
                
            } catch (error) {
                logMessage('error', `테마 매니저 테스트 실패: ${error.message}`);
            }
        };
        
        // CSS 변수 테스트
        window.testCSSVariables = function() {
            logMessage('info', 'CSS 변수 테스트를 시작합니다...');
            
            try {
                const root = document.documentElement;
                const computedStyle = getComputedStyle(root);
                
                // 다크모드 변수 테스트
                document.body.classList.add('dark');
                const darkBg = computedStyle.getPropertyValue('--bg-primary');
                const darkText = computedStyle.getPropertyValue('--text-primary');
                
                // 라이트모드 변수 테스트
                document.body.classList.remove('dark');
                document.body.classList.add('light');
                const lightBg = computedStyle.getPropertyValue('--bg-primary');
                const lightText = computedStyle.getPropertyValue('--text-primary');
                
                const cssTestPass = darkBg !== lightBg && darkText !== lightText;
                
                if (cssTestPass) {
                    logMessage('success', 'CSS 변수 테스트 통과');
                    document.getElementById('dark-variables').textContent = '정상';
                    document.getElementById('light-variables').textContent = '정상';
                } else {
                    logMessage('error', 'CSS 변수 테스트 실패');
                    document.getElementById('dark-variables').textContent = '오류';
                    document.getElementById('light-variables').textContent = '오류';
                }
                
                // 폴백 값 테스트
                const fallbackTest = darkBg.includes('#') || darkBg.includes('rgb');
                document.getElementById('fallback-values').textContent = fallbackTest ? '지원' : '미지원';
                
                // 호환성 테스트
                const compatibilityTest = CSS.supports('color', 'var(--test)');
                document.getElementById('css-compatibility').textContent = compatibilityTest ? '지원' : '미지원';
                
            } catch (error) {
                logMessage('error', `CSS 변수 테스트 실패: ${error.message}`);
            }
        };
        
        // 애니메이션 테스트
        window.testAnimations = function() {
            logMessage('info', '애니메이션 테스트를 시작합니다...');
            
            try {
                const startTime = performance.now();
                
                // 테마 전환 애니메이션 테스트
                themeManager.setTheme('dark', true, true);
                
                setTimeout(() => {
                    const endTime = performance.now();
                    const duration = endTime - startTime;
                    
                    document.getElementById('transition-speed').textContent = `${Math.round(duration)}ms`;
                    
                    if (duration < 500) {
                        logMessage('success', '애니메이션 속도 테스트 통과');
                    } else {
                        logMessage('warning', '애니메이션 속도가 느립니다');
                    }
                    
                    // GPU 가속 테스트
                    const testElement = document.createElement('div');
                    testElement.style.transform = 'translateZ(0)';
                    const gpuAcceleration = testElement.style.transform !== '';
                    document.getElementById('gpu-acceleration').textContent = gpuAcceleration ? '지원' : '미지원';
                    
                    // 접근성 테스트
                    const reducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
                    const highContrast = window.matchMedia('(prefers-contrast: high)').matches;
                    document.getElementById('accessibility').textContent = 
                        reducedMotion || highContrast ? '고려됨' : '기본';
                    
                }, 500);
                
            } catch (error) {
                logMessage('error', `애니메이션 테스트 실패: ${error.message}`);
            }
        };
        
        // 페이지별 테스트
        window.testPages = async function() {
            logMessage('info', '페이지별 테스트를 시작합니다...');
            
            // 각 페이지의 다크모드 스타일 확인
            const pages = ['home', 'search', 'calendar', 'my-logs'];
            
            for (const page of pages) {
                try {
                    // 페이지별 CSS 클래스 존재 확인
                    const pageClass = `.${page}-container`;
                    const hasDarkMode = document.querySelector(`style:contains("${pageClass}")`) !== null;
                    
                    document.getElementById(`${page}-page`).textContent = hasDarkMode ? '완료' : '미완료';
                    
                    if (hasDarkMode) {
                        logMessage('success', `${page} 페이지 다크모드 스타일 확인됨`);
                    } else {
                        logMessage('warning', `${page} 페이지 다크모드 스타일 누락`);
                    }
                } catch (error) {
                    logMessage('error', `${page} 페이지 테스트 실패: ${error.message}`);
                }
            }
        };
        
        // 결과 초기화
        window.clearResults = function() {
            document.getElementById('test-log').innerHTML = '';
            testResults = [];
            logMessage('info', '테스트 결과가 초기화되었습니다.');
        };
        
        // 메모리 사용량 확인
        function updateMemoryUsage() {
            if (performance.memory) {
                const memory = performance.memory;
                const used = Math.round(memory.usedJSHeapSize / 1024 / 1024);
                const total = Math.round(memory.totalJSHeapSize / 1024 / 1024);
                document.getElementById('memory-usage').textContent = `${used}MB / ${total}MB`;
            } else {
                document.getElementById('memory-usage').textContent = '미지원';
            }
        }
        
        // 주기적으로 메모리 사용량 업데이트
        setInterval(updateMemoryUsage, 5000);
        updateMemoryUsage();
    </script>
</body>
</html>
