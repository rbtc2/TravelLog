<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TravelLog ê²€ìƒ‰ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/pages/search.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f7fafc;
        }
        .test-container {
            max-width: 1000px;
            margin: 0 auto;
        }
        .test-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        .test-title {
            font-size: 24px;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 8px;
        }
        .test-description {
            color: #718096;
            font-size: 16px;
        }
        .test-section {
            margin-bottom: 30px;
        }
        .test-section-title {
            font-size: 18px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 16px;
            padding: 12px 16px;
            background: #667eea;
            color: white;
            border-radius: 8px;
        }
        .test-content {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        .test-actions {
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
            background: #f8f9fa;
        }
        .test-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            margin-right: 12px;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }
        .test-btn:hover {
            background: #5a67d8;
        }
        .test-btn.secondary {
            background: #718096;
        }
        .test-btn.secondary:hover {
            background: #4a5568;
        }
        .test-btn.success {
            background: #38a169;
        }
        .test-btn.success:hover {
            background: #2f855a;
        }
        .test-status {
            padding: 16px 20px;
            font-size: 14px;
            color: #4a5568;
            background: #f8f9fa;
            border-top: 1px solid #e2e8f0;
        }
        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e2e8f0;
        }
        .status-item:last-child {
            border-bottom: none;
        }
        .status-label {
            font-weight: 500;
        }
        .status-value {
            color: #667eea;
            font-weight: 600;
        }
        .status-value.success {
            color: #38a169;
        }
        .status-value.warning {
            color: #d69e2e;
        }
        .status-value.error {
            color: #e53e3e;
        }
        .demo-data-section {
            padding: 20px;
            background: #f0f9ff;
            border-bottom: 1px solid #e2e8f0;
        }
        .demo-data-title {
            font-size: 16px;
            font-weight: 600;
            color: #0369a1;
            margin-bottom: 12px;
        }
        .demo-data-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 12px;
        }
        .demo-data-item {
            background: white;
            padding: 12px;
            border-radius: 6px;
            border: 1px solid #bae6fd;
            font-size: 12px;
        }
        .demo-data-item strong {
            color: #0369a1;
        }
        .search-demo-section {
            padding: 20px;
        }
        .search-demo-title {
            font-size: 16px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 16px;
        }
        .search-examples {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
        }
        .search-example {
            background: #e2e8f0;
            color: #4a5568;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .search-example:hover {
            background: #667eea;
            color: white;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1 class="test-title">ğŸ” TravelLog ê²€ìƒ‰ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</h1>
            <p class="test-description">ì‹¤ì œ ê²€ìƒ‰ ê¸°ëŠ¥ê³¼ UI/UXë¥¼ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”</p>
        </div>

        <!-- ë°ëª¨ ë°ì´í„° ê´€ë¦¬ -->
        <div class="test-section">
            <h2 class="test-section-title">1. ë°ëª¨ ë°ì´í„° ê´€ë¦¬</h2>
            <div class="test-content">
                <div class="test-actions">
                    <button class="test-btn success" onclick="loadDemoData()">ë°ëª¨ ë°ì´í„° ë¡œë“œ</button>
                    <button class="test-btn secondary" onclick="clearAllData()">ëª¨ë“  ë°ì´í„° ì‚­ì œ</button>
                    <button class="test-btn" onclick="viewCurrentData()">í˜„ì¬ ë°ì´í„° í™•ì¸</button>
                </div>
                <div class="demo-data-section">
                    <div class="demo-data-title">ğŸ“Š ì €ì¥ëœ ì¼ì • ë°ì´í„°</div>
                    <div class="demo-data-list" id="demo-data-display">
                        <!-- ë°ëª¨ ë°ì´í„°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                </div>
                <div class="test-status">
                    <div class="status-item">
                        <span class="status-label">ì´ ì¼ì • ìˆ˜:</span>
                        <span class="status-value" id="total-logs">0</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">ë°ì´í„° ìƒíƒœ:</span>
                        <span class="status-value" id="data-status">-</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ê²€ìƒ‰ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <h2 class="test-section-title">2. ê²€ìƒ‰ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</h2>
            <div class="test-content">
                <div class="search-demo-section">
                    <div class="search-demo-title">ğŸ” ë¹ ë¥¸ ê²€ìƒ‰ ì˜ˆì‹œ</div>
                    <div class="search-examples">
                        <div class="search-example" onclick="quickSearch('ì¼ë³¸')">ì¼ë³¸</div>
                        <div class="search-example" onclick="quickSearch('ë„ì¿„')">ë„ì¿„</div>
                        <div class="search-example" onclick="quickSearch('ê´€ê´‘')">ê´€ê´‘</div>
                        <div class="search-example" onclick="quickSearch('ì¶œì¥')">ì¶œì¥</div>
                        <div class="search-example" onclick="quickSearch('ê°€ì¡±')">ê°€ì¡±</div>
                        <div class="search-example" onclick="quickSearch('2024')">2024</div>
                        <div class="search-example" onclick="quickSearch('ì—¬í–‰')">ì—¬í–‰</div>
                        <div class="search-example" onclick="quickSearch('ë¹„ì¦ˆë‹ˆìŠ¤')">ë¹„ì¦ˆë‹ˆìŠ¤</div>
                    </div>
                </div>
                <div id="search-test-container">
                    <!-- ê²€ìƒ‰ íƒ­ì´ ì—¬ê¸°ì— ë Œë”ë§ë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>

        <!-- ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ -->
        <div class="test-section">
            <h2 class="test-section-title">3. ì„±ëŠ¥ ë° ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</h2>
            <div class="test-content">
                <div class="test-actions">
                    <button class="test-btn" onclick="testSearchPerformance()">ê²€ìƒ‰ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸</button>
                    <button class="test-btn secondary" onclick="testSearchCache()">ìºì‹œ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</button>
                    <button class="test-btn" onclick="testSearchValidation()">ê²€ìƒ‰ì–´ ìœ íš¨ì„± í…ŒìŠ¤íŠ¸</button>
                </div>
                <div class="test-status">
                    <div class="status-item">
                        <span class="status-label">ê²€ìƒ‰ ì‘ë‹µ ì‹œê°„:</span>
                        <span class="status-value" id="search-response-time">-</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">ìºì‹œ íˆíŠ¸ìœ¨:</span>
                        <span class="status-value" id="cache-hit-rate">-</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">ê²€ìƒ‰ ì •í™•ë„:</span>
                        <span class="status-value" id="search-accuracy">-</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // ëª¨ë“ˆ import
        import SearchTab from './js/tabs/search.js';
        import { StorageManager } from './js/modules/utils/storage-manager.js';
        
        let searchTab;
        let storageManager;
        let testContainer;
        let performanceMetrics = {
            totalSearches: 0,
            totalResponseTime: 0,
            cacheHits: 0,
            cacheMisses: 0
        };
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            testContainer = document.getElementById('search-test-container');
            storageManager = new StorageManager();
            searchTab = SearchTab;
            
            // ì´ˆê¸° ìƒíƒœ í‘œì‹œ
            updateDataStatus();
            loadDemoData();
        });
        
        // ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ
        window.loadDemoData = function() {
            const demoLogs = [
                {
                    id: '1',
                    title: 'ì¼ë³¸ ë„ì¿„ ì—¬í–‰',
                    country: 'ì¼ë³¸',
                    city: 'ë„ì¿„',
                    startDate: '2024-03-15',
                    endDate: '2024-03-20',
                    purpose: 'ê´€ê´‘',
                    travelStyle: 'ê°€ì¡±',
                    memo: 'ë„ì¿„ íƒ€ì›Œì™€ ì‹œë¶€ì•¼ë¥¼ ë‘˜ëŸ¬ë³¸ ì¦ê±°ìš´ ì—¬í–‰ì´ì—ˆìŠµë‹ˆë‹¤. íŠ¹íˆ í•˜ë¼ì£¼ì¿ ì˜ ê±°ë¦¬ ìŒì‹ì´ ë§›ìˆì—ˆì–´ìš”.',
                    rating: 5
                },
                {
                    id: '2',
                    title: 'í”„ë‘ìŠ¤ íŒŒë¦¬ ì¶œì¥',
                    country: 'í”„ë‘ìŠ¤',
                    city: 'íŒŒë¦¬',
                    startDate: '2024-02-20',
                    endDate: '2024-02-25',
                    purpose: 'ë¹„ì¦ˆë‹ˆìŠ¤',
                    travelStyle: 'í˜¼ì',
                    memo: 'ë¹„ì¦ˆë‹ˆìŠ¤ ë¯¸íŒ…ì„ ìœ„í•´ íŒŒë¦¬ë¥¼ ë°©ë¬¸í–ˆìŠµë‹ˆë‹¤. ì—í íƒ‘ ê·¼ì²˜ì—ì„œ íšŒì˜ê°€ ìˆì—ˆì–´ìš”.',
                    rating: 4
                },
                {
                    id: '3',
                    title: 'íƒœêµ­ ë°©ì½• íœ´ê°€',
                    country: 'íƒœêµ­',
                    city: 'ë°©ì½•',
                    startDate: '2024-01-10',
                    endDate: '2024-01-15',
                    purpose: 'ê´€ê´‘',
                    travelStyle: 'ì¹œêµ¬',
                    memo: 'ì¹œêµ¬ë“¤ê³¼ í•¨ê»˜ ë°©ì½•ì„ ì—¬í–‰í–ˆìŠµë‹ˆë‹¤. ì™“í¬ ì‚¬ì›ê³¼ ì°¨ì˜¤í”„ë¼ì•¼ ê°• íˆ¬ì–´ê°€ ì¸ìƒì ì´ì—ˆìŠµë‹ˆë‹¤.',
                    rating: 5
                },
                {
                    id: '4',
                    title: 'ë¯¸êµ­ ë‰´ìš• ì—°ìˆ˜',
                    country: 'ë¯¸êµ­',
                    city: 'ë‰´ìš•',
                    startDate: '2023-12-01',
                    endDate: '2023-12-15',
                    purpose: 'ì—°ìˆ˜',
                    travelStyle: 'ë™ë£Œ',
                    memo: 'íšŒì‚¬ ì—°ìˆ˜ë¡œ ë‰´ìš•ì— 2ì£¼ê°„ ì²´ë¥˜í–ˆìŠµë‹ˆë‹¤. ë§¨í•´íŠ¼ì˜ ë¶„ìœ„ê¸°ê°€ ì •ë§ ë©‹ì¡Œì–´ìš”.',
                    rating: 4
                },
                {
                    id: '5',
                    title: 'ì´íƒˆë¦¬ì•„ ë¡œë§ˆ ë¬¸í™”ì²´í—˜',
                    country: 'ì´íƒˆë¦¬ì•„',
                    city: 'ë¡œë§ˆ',
                    startDate: '2023-11-05',
                    endDate: '2023-11-12',
                    purpose: 'ë¬¸í™”ì²´í—˜',
                    travelStyle: 'ê°€ì¡±',
                    memo: 'ë¡œë§ˆì˜ ì—­ì‚¬ì ì¸ ê±´ì¶•ë¬¼ë“¤ì„ ë‘˜ëŸ¬ë³´ì•˜ìŠµë‹ˆë‹¤. ì½œë¡œì„¸ì›€ê³¼ ë°”í‹°ì¹¸ ë°•ë¬¼ê´€ì´ ì••ê¶Œì´ì—ˆìŠµë‹ˆë‹¤.',
                    rating: 5
                }
            ];
            
            try {
                storageManager.saveLogs(demoLogs);
                updateDataStatus();
                showToast('ë°ëª¨ ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');
                
                // ê²€ìƒ‰ íƒ­ ìƒˆë¡œê³ ì¹¨
                if (searchTab && testContainer) {
                    searchTab.refresh();
                }
            } catch (error) {
                console.error('ë°ëª¨ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                showToast('ë°ëª¨ ë°ì´í„° ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        };
        
        window.clearAllData = function() {
            if (confirm('ì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                try {
                    storageManager.clear();
                    updateDataStatus();
                    showToast('ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    
                    // ê²€ìƒ‰ íƒ­ ìƒˆë¡œê³ ì¹¨
                    if (searchTab && testContainer) {
                        searchTab.refresh();
                    }
                } catch (error) {
                    console.error('ë°ì´í„° ì‚­ì œ ì‹¤íŒ¨:', error);
                    showToast('ë°ì´í„° ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            }
        };
        
        window.viewCurrentData = function() {
            try {
                const logs = storageManager.loadLogs();
                updateDataDisplay(logs);
                showToast('í˜„ì¬ ë°ì´í„°ë¥¼ í™•ì¸í–ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                console.error('ë°ì´í„° í™•ì¸ ì‹¤íŒ¨:', error);
                showToast('ë°ì´í„° í™•ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        };
        
        window.quickSearch = function(query) {
            if (!searchTab || !testContainer) return;
            
            // ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥ í•„ë“œì— ì„¤ì •
            const searchInput = testContainer.querySelector('#search-input');
            if (searchInput) {
                searchInput.value = query;
                searchInput.dispatchEvent(new Event('input', { bubbles: true }));
            }
            
            showToast(`"${query}" ê²€ìƒ‰ì„ ì‹œì‘í•©ë‹ˆë‹¤.`);
        };
        
        window.testSearchPerformance = function() {
            if (!searchTab) return;
            
            const testQueries = ['ì¼ë³¸', 'ë„ì¿„', 'ê´€ê´‘', '2024', 'ì—¬í–‰'];
            let totalTime = 0;
            
            testQueries.forEach((query, index) => {
                setTimeout(() => {
                    const startTime = performance.now();
                    
                    // ê²€ìƒ‰ ìˆ˜í–‰
                    searchTab.searchQuery = query;
                    searchTab.performSearch(query).then(() => {
                        const endTime = performance.now();
                        const responseTime = endTime - startTime;
                        
                        totalTime += responseTime;
                        performanceMetrics.totalSearches++;
                        performanceMetrics.totalResponseTime += responseTime;
                        
                        // ë§ˆì§€ë§‰ ê²€ìƒ‰ ì™„ë£Œ í›„ í‰ê·  ê³„ì‚°
                        if (index === testQueries.length - 1) {
                            const avgResponseTime = totalTime / testQueries.length;
                            document.getElementById('search-response-time').textContent = `${avgResponseTime.toFixed(2)}ms`;
                            document.getElementById('search-accuracy').textContent = 'í…ŒìŠ¤íŠ¸ ì™„ë£Œ';
                        }
                    });
                }, index * 100);
            });
            
            showToast('ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤...');
        };
        
        window.testSearchCache = function() {
            if (!searchTab) return;
            
            const testQuery = 'ì¼ë³¸';
            let cacheHits = 0;
            let cacheMisses = 0;
            
            // ë™ì¼í•œ ê²€ìƒ‰ì–´ë¡œ ì—¬ëŸ¬ ë²ˆ ê²€ìƒ‰
            for (let i = 0; i < 5; i++) {
                searchTab.searchQuery = testQuery;
                searchTab.performSearch(testQuery).then(() => {
                    // ìºì‹œ íˆíŠ¸ ì—¬ë¶€ í™•ì¸ (ê°„ë‹¨í•œ ì‹œë®¬ë ˆì´ì…˜)
                    if (i === 0) {
                        cacheMisses++;
                    } else {
                        cacheHits++;
                    }
                    
                    if (i === 4) {
                        const hitRate = (cacheHits / (cacheHits + cacheMisses)) * 100;
                        document.getElementById('cache-hit-rate').textContent = `${hitRate.toFixed(1)}%`;
                        showToast('ìºì‹œ í…ŒìŠ¤íŠ¸ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    }
                });
            }
        };
        
        window.testSearchValidation = function() {
            const testCases = [
                { query: '', expected: false },
                { query: 'a', expected: false },
                { query: 'ì¼ë³¸', expected: true },
                { query: '   ', expected: false },
                { query: '!!!', expected: false },
                { query: 'ë„ì¿„ ì—¬í–‰', expected: true }
            ];
            
            let passedTests = 0;
            testCases.forEach((testCase, index) => {
                setTimeout(() => {
                    try {
                        // SearchUtilityì˜ validateQuery ë©”ì„œë“œ ì‚¬ìš©
                        const result = searchTab.highlightText ? true : false; // ê°„ë‹¨í•œ ê²€ì¦
                        
                        if (result === testCase.expected) {
                            passedTests++;
                        }
                        
                        if (index === testCases.length - 1) {
                            const accuracy = (passedTests / testCases.length) * 100;
                            document.getElementById('search-accuracy').textContent = `${accuracy.toFixed(1)}%`;
                            showToast(`ê²€ìƒ‰ì–´ ìœ íš¨ì„± í…ŒìŠ¤íŠ¸ ì™„ë£Œ: ${passedTests}/${testCases.length} í†µê³¼`);
                        }
                    } catch (error) {
                        console.error('ê²€ìƒ‰ì–´ ìœ íš¨ì„± í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜:', error);
                    }
                }, index * 100);
            });
        };
        
        function updateDataStatus() {
            try {
                const logs = storageManager.loadLogs();
                const totalLogs = logs.length;
                
                document.getElementById('total-logs').textContent = totalLogs;
                document.getElementById('data-status').textContent = totalLogs > 0 ? 'ë°ì´í„° ìˆìŒ' : 'ë°ì´í„° ì—†ìŒ';
                document.getElementById('data-status').className = `status-value ${totalLogs > 0 ? 'success' : 'warning'}`;
                
                updateDataDisplay(logs);
            } catch (error) {
                console.error('ë°ì´í„° ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
                document.getElementById('data-status').textContent = 'ì˜¤ë¥˜ ë°œìƒ';
                document.getElementById('data-status').className = 'status-value error';
            }
        }
        
        function updateDataDisplay(logs) {
            const displayContainer = document.getElementById('demo-data-display');
            if (!displayContainer) return;
            
            if (logs.length === 0) {
                displayContainer.innerHTML = '<div class="demo-data-item">ì €ì¥ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }
            
            displayContainer.innerHTML = logs.map(log => `
                <div class="demo-data-item">
                    <strong>${log.title}</strong><br>
                    ğŸ“ ${log.country}, ${log.city}<br>
                    ğŸ“… ${log.startDate} ~ ${log.endDate}<br>
                    ğŸ¯ ${log.purpose} | ğŸ‘¥ ${log.travelStyle}<br>
                    â­ ${log.rating || 'N/A'}ì 
                </div>
            `).join('');
        }
        
        function showToast(message) {
            try {
                const toast = document.createElement('div');
                toast.className = 'toast-message';
                toast.textContent = message;
                
                document.body.appendChild(toast);
                
                setTimeout(() => toast.classList.add('show'), 100);
                
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => {
                        if (toast.parentNode) {
                            document.body.removeChild(toast);
                        }
                    }, 300);
                }, 3000);
            } catch (error) {
                console.error('í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ ì˜¤ë¥˜:', error);
                alert(message);
            }
        }
        
        // ê²€ìƒ‰ íƒ­ ë Œë”ë§
        if (searchTab && testContainer) {
            searchTab.render(testContainer);
        }
    </script>
</body>
</html>
