<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TravelLog Phase 4 통합 테스트</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        
        .test-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .test-header {
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border-left: 4px solid #28a745;
            background-color: #f8f9fa;
        }
        
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
        }
        
        .test-pass {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .test-fail {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .test-info {
            background-color: #cce7ff;
            border: 1px solid #b8daff;
            color: #004085;
        }
        
        .performance-metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        
        .metric {
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        
        .metric-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #007bff;
        }
        
        .metric-label {
            font-size: 0.9em;
            color: #6c757d;
        }
        
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        .test-button:hover {
            background: #0056b3;
        }
        
        .error-details {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>🧪 TravelLog Phase 4 통합 테스트</h1>
            <p>리팩토링된 서비스들의 통합 테스트 및 성능 검증</p>
        </div>
        
        <div class="test-section">
            <h2>🎯 테스트 제어</h2>
            <button class="test-button" onclick="runAllTests()">전체 테스트 실행</button>
            <button class="test-button" onclick="runUtilityTests()">유틸리티 테스트</button>
            <button class="test-button" onclick="runServiceTests()">서비스 테스트</button>
            <button class="test-button" onclick="runPerformanceTests()">성능 테스트</button>
            <button class="test-button" onclick="clearResults()">결과 초기화</button>
        </div>
        
        <div class="test-section">
            <h2>📊 테스트 결과 요약</h2>
            <div class="performance-metrics">
                <div class="metric">
                    <div class="metric-value" id="total-tests">0</div>
                    <div class="metric-label">총 테스트</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="passed-tests">0</div>
                    <div class="metric-label">성공</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="failed-tests">0</div>
                    <div class="metric-label">실패</div>
                </div>
            </div>
        </div>
        
        <div id="test-results">
            <!-- 테스트 결과가 여기에 표시됩니다 -->
        </div>
    </div>

    <!-- 테스트 대상 모듈들 Import -->
    <script type="module">
        // Phase 4에서 리팩토링된 유틸리티들 import
        import { DateUtils } from '../js/modules/utils/date-utils.js';
        import { CountryUtils } from '../js/modules/utils/country-utils.js';
        import { StatsUtils } from '../js/modules/utils/stats-utils.js';
        import { ValidationUtils } from '../js/modules/utils/validation-utils.js';
        
        // 서비스들 import (mockData 사용)
        import { LogDataService } from '../js/modules/services/log-data-service.js';
        import { CacheManager } from '../js/modules/services/cache-manager.js';
        import { BasicStatsService } from '../js/modules/services/basic-stats-service.js';
        import { CountryAnalysisService } from '../js/modules/services/country-analysis-service.js';
        import { PurposeAnalysisService } from '../js/modules/services/purpose-analysis-service.js';
        import { YearlyStatsService } from '../js/modules/services/yearly-stats-service.js';
        
        // 전역 변수로 설정하여 HTML에서 접근 가능하게 함
        window.testModules = {
            DateUtils,
            CountryUtils,
            StatsUtils,
            ValidationUtils,
            LogDataService,
            CacheManager,
            BasicStatsService,
            CountryAnalysisService,
            PurposeAnalysisService,
            YearlyStatsService
        };
        
        // 테스트 데이터
        window.mockTravelLogs = [
            {
                id: '1',
                country: 'JP',
                city: '도쿄',
                startDate: '2024-01-15',
                endDate: '2024-01-20',
                purpose: 'tourism',
                rating: 4.5,
                title: '도쿄 여행',
                description: '도쿄에서의 즐거운 여행'
            },
            {
                id: '2',
                country: 'US',
                city: '뉴욕',
                startDate: '2024-03-10',
                endDate: '2024-03-17',
                purpose: 'business',
                rating: 4.0,
                title: '뉴욕 출장',
                description: '비즈니스 미팅'
            },
            {
                id: '3',
                country: 'FR',
                city: '파리',
                startDate: '2024-06-05',
                endDate: '2024-06-12',
                purpose: 'tourism',
                rating: 5.0,
                title: '파리 여행',
                description: '로맨틱한 파리'
            },
            {
                id: '4',
                country: 'KR',
                city: '서울',
                startDate: '2023-12-01',
                endDate: '2023-12-05',
                purpose: 'family',
                rating: 4.2,
                title: '서울 방문',
                description: '가족 방문'
            }
        ];
        
        console.log('✅ 테스트 모듈들이 로드되었습니다.');
    </script>
    
    <script>
        // 테스트 카운터
        let testStats = {
            total: 0,
            passed: 0,
            failed: 0
        };
        
        // 테스트 결과 표시 함수
        function logTest(testName, success, details = '', errorDetails = '') {
            const resultsDiv = document.getElementById('test-results');
            const testDiv = document.createElement('div');
            testDiv.className = `test-result ${success ? 'test-pass' : 'test-fail'}`;
            
            let content = `${success ? '✅' : '❌'} ${testName}`;
            if (details) {
                content += `<br><small>${details}</small>`;
            }
            if (errorDetails) {
                content += `<div class="error-details">${errorDetails}</div>`;
            }
            
            testDiv.innerHTML = content;
            resultsDiv.appendChild(testDiv);
            
            // 통계 업데이트
            testStats.total++;
            if (success) {
                testStats.passed++;
            } else {
                testStats.failed++;
            }
            
            updateTestStats();
        }
        
        function logInfo(message) {
            const resultsDiv = document.getElementById('test-results');
            const infoDiv = document.createElement('div');
            infoDiv.className = 'test-result test-info';
            infoDiv.innerHTML = `ℹ️ ${message}`;
            resultsDiv.appendChild(infoDiv);
        }
        
        function updateTestStats() {
            document.getElementById('total-tests').textContent = testStats.total;
            document.getElementById('passed-tests').textContent = testStats.passed;
            document.getElementById('failed-tests').textContent = testStats.failed;
        }
        
        function clearResults() {
            document.getElementById('test-results').innerHTML = '';
            testStats = { total: 0, passed: 0, failed: 0 };
            updateTestStats();
        }
        
        // 유틸리티 테스트 함수들
        function runUtilityTests() {
            logInfo('📅 DateUtils 테스트 시작');
            testDateUtils();
            
            logInfo('🌍 CountryUtils 테스트 시작');
            testCountryUtils();
            
            logInfo('📊 StatsUtils 테스트 시작');
            testStatsUtils();
            
            logInfo('✅ ValidationUtils 테스트 시작');
            testValidationUtils();
        }
        
        function testDateUtils() {
            try {
                const { DateUtils } = window.testModules;
                
                // 날짜 검증 테스트
                logTest('DateUtils.isValidDate', 
                    DateUtils.isValidDate('2024-01-15') === true,
                    '유효한 날짜 검증 통과');
                
                logTest('DateUtils.isValidDate (잘못된 날짜)', 
                    DateUtils.isValidDate('invalid-date') === false,
                    '잘못된 날짜 검증 통과');
                
                // 일수 계산 테스트
                const days = DateUtils.calculateDaysBetween('2024-01-15', '2024-01-20');
                logTest('DateUtils.calculateDaysBetween', 
                    days === 6,
                    `계산된 일수: ${days}일 (예상: 6일)`);
                
                // 연도 추출 테스트
                const years = DateUtils.extractYearsFromLogs(window.mockTravelLogs);
                logTest('DateUtils.extractYearsFromLogs', 
                    years.includes('2024') && years.includes('2023'),
                    `추출된 연도: ${years.join(', ')}`);
                
                // 현재 연도 테스트
                const currentYear = DateUtils.getCurrentYear();
                const actualCurrentYear = new Date().getFullYear().toString();
                logTest('DateUtils.getCurrentYear', 
                    currentYear === actualCurrentYear,
                    `현재 연도: ${currentYear} (실제: ${actualCurrentYear})`);
                
            } catch (error) {
                logTest('DateUtils 테스트', false, '', `오류: ${error.message}`);
            }
        }
        
        function testCountryUtils() {
            try {
                const { CountryUtils } = window.testModules;
                
                // 국가명 변환 테스트
                logTest('CountryUtils.getCountryName', 
                    CountryUtils.getCountryName('JP') === '일본',
                    'JP → 일본 변환 성공');
                
                logTest('CountryUtils.getCountryName (존재하지 않는 국가)', 
                    CountryUtils.getCountryName('XX') === 'XX',
                    '존재하지 않는 국가 코드 처리 성공');
                
                // 대륙별 분류 테스트 (영어 키 사용)
                const asianCountries = CountryUtils.getCountriesByContinent('Asia');
                logTest('CountryUtils.getCountriesByContinent', 
                    asianCountries.length > 0 && asianCountries.some(country => country.code === 'JP'),
                    `아시아 국가 ${asianCountries.length}개 조회됨`);
                
                // 로그 필터링 테스트
                const japanLogs = CountryUtils.filterLogsByCountry(window.mockTravelLogs, 'JP');
                logTest('CountryUtils.filterLogsByCountry', 
                    japanLogs.length === 1 && japanLogs[0].country === 'JP',
                    '일본 로그 1개 필터링 성공');
                
            } catch (error) {
                logTest('CountryUtils 테스트', false, '', `오류: ${error.message}`);
            }
        }
        
        function testStatsUtils() {
            try {
                const { StatsUtils } = window.testModules;
                
                const testData = [1, 2, 3, 4, 5];
                
                // 합계 테스트
                logTest('StatsUtils.sum', 
                    StatsUtils.sum(testData) === 15,
                    `합계: ${StatsUtils.sum(testData)} (예상: 15)`);
                
                // 평균 테스트
                logTest('StatsUtils.average', 
                    StatsUtils.average(testData, 1) === 3.0,
                    `평균: ${StatsUtils.average(testData, 1)} (예상: 3.0)`);
                
                // 최대/최소값 테스트
                logTest('StatsUtils.max', 
                    StatsUtils.max(testData) === 5,
                    `최대값: ${StatsUtils.max(testData)} (예상: 5)`);
                
                logTest('StatsUtils.min', 
                    StatsUtils.min(testData) === 1,
                    `최소값: ${StatsUtils.min(testData)} (예상: 1)`);
                
                // 빈도 분석 테스트
                const frequencyData = window.mockTravelLogs;
                const purposeFreq = StatsUtils.frequency(frequencyData, 'purpose');
                logTest('StatsUtils.frequency', 
                    purposeFreq.length > 0 && purposeFreq[0].hasOwnProperty('value'),
                    `목적별 빈도 분석 완료 (${purposeFreq.length}개 항목)`);
                
                // 증감률 테스트
                const changeRate = StatsUtils.changeRate(100, 80, 1);
                logTest('StatsUtils.changeRate', 
                    changeRate.type === 'increase' && changeRate.rate === 25.0,
                    `증감률: ${changeRate.display} (유형: ${changeRate.type})`);
                
            } catch (error) {
                logTest('StatsUtils 테스트', false, '', `오류: ${error.message}`);
            }
        }
        
        function testValidationUtils() {
            try {
                const { ValidationUtils } = window.testModules;
                
                // 로그 검증 테스트
                const validLog = {
                    country: 'JP',
                    city: '도쿄',
                    startDate: '2024-01-15',
                    endDate: '2024-01-20',
                    purpose: 'tourism',
                    rating: 4.5
                };
                
                const validation = ValidationUtils.validateTravelLog(validLog);
                logTest('ValidationUtils.validateTravelLog (유효한 로그)', 
                    validation.isValid === true,
                    `검증 결과: ${validation.isValid ? '유효함' : '무효함'}`);
                
                // 무효한 로그 테스트
                const invalidLog = {
                    country: '',
                    city: '',
                    startDate: 'invalid-date',
                    endDate: '2024-01-15',
                    purpose: 'invalid-purpose',
                    rating: 10
                };
                
                const invalidValidation = ValidationUtils.validateTravelLog(invalidLog);
                logTest('ValidationUtils.validateTravelLog (무효한 로그)', 
                    invalidValidation.isValid === false && invalidValidation.errors.length > 0,
                    `검증 오류 ${invalidValidation.errors.length}개 감지됨`);
                
                // 필수 필드 검증 테스트
                logTest('ValidationUtils.isRequired', 
                    ValidationUtils.isRequired('테스트') === true && ValidationUtils.isRequired('') === false,
                    '필수 필드 검증 통과');
                
                // 날짜 범위 검증 테스트
                logTest('ValidationUtils.isDateInRange', 
                    ValidationUtils.isDateInRange('2024-01-15') === true,
                    '날짜 범위 검증 통과');
                
            } catch (error) {
                logTest('ValidationUtils 테스트', false, '', `오류: ${error.message}`);
            }
        }
        
        // 간단한 서비스 테스트
        function runServiceTests() {
            logInfo('🔧 서비스 기본 테스트 시작');
            testBasicModules();
        }
        
        function testBasicModules() {
            try {
                // 모듈 로드 확인
                logTest('모듈 로드 확인', 
                    window.testModules && window.testModules.DateUtils,
                    '모든 테스트 모듈이 정상적으로 로드됨');
                
                // Mock 데이터 확인
                logTest('Mock 데이터 확인', 
                    window.mockTravelLogs && window.mockTravelLogs.length === 4,
                    `테스트 데이터 ${window.mockTravelLogs.length}개 준비됨`);
                
            } catch (error) {
                logTest('서비스 테스트', false, '', `오류: ${error.message}`);
            }
        }
        
        // 성능 테스트 함수들
        function runPerformanceTests() {
            logInfo('⚡ 성능 테스트 시작');
            testPerformance();
        }
        
        function testPerformance() {
            try {
                const { StatsUtils, DateUtils, CountryUtils } = window.testModules;
                
                // 기본 성능 테스트
                const testData = Array.from({length: 1000}, (_, i) => i + 1);
                
                const start1 = performance.now();
                StatsUtils.sum(testData);
                const end1 = performance.now();
                
                logTest('StatsUtils 성능 테스트', 
                    (end1 - start1) < 100,
                    `1000개 숫자 합계 계산: ${(end1 - start1).toFixed(2)}ms`);
                
                // 메모리 사용량 체크
                const memoryInfo = performance.memory || {};
                logTest('메모리 사용량 체크', 
                    true,
                    `사용 메모리: ${(memoryInfo.usedJSHeapSize / 1024 / 1024).toFixed(2)}MB`);
                
            } catch (error) {
                logTest('성능 테스트', false, '', `오류: ${error.message}`);
            }
        }
        
        // 전체 테스트 실행
        function runAllTests() {
            clearResults();
            logInfo('🚀 전체 테스트 시작');
            
            runUtilityTests();
            runServiceTests();
            runPerformanceTests();
            
            logInfo('✨ 전체 테스트 완료');
        }
        
        // 페이지 로드 시 자동 실행
        window.addEventListener('load', () => {
            setTimeout(() => {
                logInfo('🎯 TravelLog Phase 4 통합 테스트가 준비되었습니다.');
                logInfo('상단의 버튼을 클릭하여 테스트를 실행하세요.');
            }, 1000);
        });
    </script>
</body>
</html>
