<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TravelLog Phase 4 í†µí•© í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        
        .test-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .test-header {
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border-left: 4px solid #28a745;
            background-color: #f8f9fa;
        }
        
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
        }
        
        .test-pass {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .test-fail {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .test-info {
            background-color: #cce7ff;
            border: 1px solid #b8daff;
            color: #004085;
        }
        
        .performance-metrics {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        
        .metric {
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        
        .metric-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #007bff;
        }
        
        .metric-label {
            font-size: 0.9em;
            color: #6c757d;
        }
        
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        .test-button:hover {
            background: #0056b3;
        }
        
        .error-details {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>ğŸ§ª TravelLog Phase 4 í†µí•© í…ŒìŠ¤íŠ¸</h1>
            <p>ë¦¬íŒ©í† ë§ëœ ì„œë¹„ìŠ¤ë“¤ì˜ í†µí•© í…ŒìŠ¤íŠ¸ ë° ì„±ëŠ¥ ê²€ì¦</p>
        </div>
        
        <div class="test-section">
            <h2>ğŸ¯ í…ŒìŠ¤íŠ¸ ì œì–´</h2>
            <button class="test-button" onclick="runAllTests()">ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
            <button class="test-button" onclick="runUtilityTests()">ìœ í‹¸ë¦¬í‹° í…ŒìŠ¤íŠ¸</button>
            <button class="test-button" onclick="runServiceTests()">ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸</button>
            <button class="test-button" onclick="runPerformanceTests()">ì„±ëŠ¥ í…ŒìŠ¤íŠ¸</button>
            <button class="test-button" onclick="clearResults()">ê²°ê³¼ ì´ˆê¸°í™”</button>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“Š í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½</h2>
            <div class="performance-metrics">
                <div class="metric">
                    <div class="metric-value" id="total-tests">0</div>
                    <div class="metric-label">ì´ í…ŒìŠ¤íŠ¸</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="passed-tests">0</div>
                    <div class="metric-label">ì„±ê³µ</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="failed-tests">0</div>
                    <div class="metric-label">ì‹¤íŒ¨</div>
                </div>
            </div>
        </div>
        
        <div id="test-results">
            <!-- í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
        </div>
    </div>

    <!-- í…ŒìŠ¤íŠ¸ ëŒ€ìƒ ëª¨ë“ˆë“¤ Import -->
    <script type="module">
        // Phase 4ì—ì„œ ë¦¬íŒ©í† ë§ëœ ìœ í‹¸ë¦¬í‹°ë“¤ import
        import { DateUtils } from '../js/modules/utils/date-utils.js';
        import { CountryUtils } from '../js/modules/utils/country-utils.js';
        import { StatsUtils } from '../js/modules/utils/stats-utils.js';
        import { ValidationUtils } from '../js/modules/utils/validation-utils.js';
        
        // ì„œë¹„ìŠ¤ë“¤ import (mockData ì‚¬ìš©)
        import { LogDataService } from '../js/modules/services/log-data-service.js';
        import { CacheManager } from '../js/modules/services/cache-manager.js';
        import { BasicStatsService } from '../js/modules/services/basic-stats-service.js';
        import { CountryAnalysisService } from '../js/modules/services/country-analysis-service.js';
        import { PurposeAnalysisService } from '../js/modules/services/purpose-analysis-service.js';
        import { YearlyStatsService } from '../js/modules/services/yearly-stats-service.js';
        
        // ì „ì—­ ë³€ìˆ˜ë¡œ ì„¤ì •í•˜ì—¬ HTMLì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ê²Œ í•¨
        window.testModules = {
            DateUtils,
            CountryUtils,
            StatsUtils,
            ValidationUtils,
            LogDataService,
            CacheManager,
            BasicStatsService,
            CountryAnalysisService,
            PurposeAnalysisService,
            YearlyStatsService
        };
        
        // í…ŒìŠ¤íŠ¸ ë°ì´í„°
        window.mockTravelLogs = [
            {
                id: '1',
                country: 'JP',
                city: 'ë„ì¿„',
                startDate: '2024-01-15',
                endDate: '2024-01-20',
                purpose: 'tourism',
                rating: 4.5,
                title: 'ë„ì¿„ ì—¬í–‰',
                description: 'ë„ì¿„ì—ì„œì˜ ì¦ê±°ìš´ ì—¬í–‰'
            },
            {
                id: '2',
                country: 'US',
                city: 'ë‰´ìš•',
                startDate: '2024-03-10',
                endDate: '2024-03-17',
                purpose: 'business',
                rating: 4.0,
                title: 'ë‰´ìš• ì¶œì¥',
                description: 'ë¹„ì¦ˆë‹ˆìŠ¤ ë¯¸íŒ…'
            },
            {
                id: '3',
                country: 'FR',
                city: 'íŒŒë¦¬',
                startDate: '2024-06-05',
                endDate: '2024-06-12',
                purpose: 'tourism',
                rating: 5.0,
                title: 'íŒŒë¦¬ ì—¬í–‰',
                description: 'ë¡œë§¨í‹±í•œ íŒŒë¦¬'
            },
            {
                id: '4',
                country: 'KR',
                city: 'ì„œìš¸',
                startDate: '2023-12-01',
                endDate: '2023-12-05',
                purpose: 'family',
                rating: 4.2,
                title: 'ì„œìš¸ ë°©ë¬¸',
                description: 'ê°€ì¡± ë°©ë¬¸'
            }
        ];
        
        console.log('âœ… í…ŒìŠ¤íŠ¸ ëª¨ë“ˆë“¤ì´ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
    </script>
    
    <script>
        // í…ŒìŠ¤íŠ¸ ì¹´ìš´í„°
        let testStats = {
            total: 0,
            passed: 0,
            failed: 0
        };
        
        // í…ŒìŠ¤íŠ¸ ê²°ê³¼ í‘œì‹œ í•¨ìˆ˜
        function logTest(testName, success, details = '', errorDetails = '') {
            const resultsDiv = document.getElementById('test-results');
            const testDiv = document.createElement('div');
            testDiv.className = `test-result ${success ? 'test-pass' : 'test-fail'}`;
            
            let content = `${success ? 'âœ…' : 'âŒ'} ${testName}`;
            if (details) {
                content += `<br><small>${details}</small>`;
            }
            if (errorDetails) {
                content += `<div class="error-details">${errorDetails}</div>`;
            }
            
            testDiv.innerHTML = content;
            resultsDiv.appendChild(testDiv);
            
            // í†µê³„ ì—…ë°ì´íŠ¸
            testStats.total++;
            if (success) {
                testStats.passed++;
            } else {
                testStats.failed++;
            }
            
            updateTestStats();
        }
        
        function logInfo(message) {
            const resultsDiv = document.getElementById('test-results');
            const infoDiv = document.createElement('div');
            infoDiv.className = 'test-result test-info';
            infoDiv.innerHTML = `â„¹ï¸ ${message}`;
            resultsDiv.appendChild(infoDiv);
        }
        
        function updateTestStats() {
            document.getElementById('total-tests').textContent = testStats.total;
            document.getElementById('passed-tests').textContent = testStats.passed;
            document.getElementById('failed-tests').textContent = testStats.failed;
        }
        
        function clearResults() {
            document.getElementById('test-results').innerHTML = '';
            testStats = { total: 0, passed: 0, failed: 0 };
            updateTestStats();
        }
        
        // ìœ í‹¸ë¦¬í‹° í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤
        function runUtilityTests() {
            logInfo('ğŸ“… DateUtils í…ŒìŠ¤íŠ¸ ì‹œì‘');
            testDateUtils();
            
            logInfo('ğŸŒ CountryUtils í…ŒìŠ¤íŠ¸ ì‹œì‘');
            testCountryUtils();
            
            logInfo('ğŸ“Š StatsUtils í…ŒìŠ¤íŠ¸ ì‹œì‘');
            testStatsUtils();
            
            logInfo('âœ… ValidationUtils í…ŒìŠ¤íŠ¸ ì‹œì‘');
            testValidationUtils();
        }
        
        function testDateUtils() {
            try {
                const { DateUtils } = window.testModules;
                
                // ë‚ ì§œ ê²€ì¦ í…ŒìŠ¤íŠ¸
                logTest('DateUtils.isValidDate', 
                    DateUtils.isValidDate('2024-01-15') === true,
                    'ìœ íš¨í•œ ë‚ ì§œ ê²€ì¦ í†µê³¼');
                
                logTest('DateUtils.isValidDate (ì˜ëª»ëœ ë‚ ì§œ)', 
                    DateUtils.isValidDate('invalid-date') === false,
                    'ì˜ëª»ëœ ë‚ ì§œ ê²€ì¦ í†µê³¼');
                
                // ì¼ìˆ˜ ê³„ì‚° í…ŒìŠ¤íŠ¸
                const days = DateUtils.calculateDaysBetween('2024-01-15', '2024-01-20');
                logTest('DateUtils.calculateDaysBetween', 
                    days === 6,
                    `ê³„ì‚°ëœ ì¼ìˆ˜: ${days}ì¼ (ì˜ˆìƒ: 6ì¼)`);
                
                // ì—°ë„ ì¶”ì¶œ í…ŒìŠ¤íŠ¸
                const years = DateUtils.extractYearsFromLogs(window.mockTravelLogs);
                logTest('DateUtils.extractYearsFromLogs', 
                    years.includes('2024') && years.includes('2023'),
                    `ì¶”ì¶œëœ ì—°ë„: ${years.join(', ')}`);
                
                // í˜„ì¬ ì—°ë„ í…ŒìŠ¤íŠ¸
                const currentYear = DateUtils.getCurrentYear();
                const actualCurrentYear = new Date().getFullYear().toString();
                logTest('DateUtils.getCurrentYear', 
                    currentYear === actualCurrentYear,
                    `í˜„ì¬ ì—°ë„: ${currentYear} (ì‹¤ì œ: ${actualCurrentYear})`);
                
            } catch (error) {
                logTest('DateUtils í…ŒìŠ¤íŠ¸', false, '', `ì˜¤ë¥˜: ${error.message}`);
            }
        }
        
        function testCountryUtils() {
            try {
                const { CountryUtils } = window.testModules;
                
                // êµ­ê°€ëª… ë³€í™˜ í…ŒìŠ¤íŠ¸
                logTest('CountryUtils.getCountryName', 
                    CountryUtils.getCountryName('JP') === 'ì¼ë³¸',
                    'JP â†’ ì¼ë³¸ ë³€í™˜ ì„±ê³µ');
                
                logTest('CountryUtils.getCountryName (ì¡´ì¬í•˜ì§€ ì•ŠëŠ” êµ­ê°€)', 
                    CountryUtils.getCountryName('XX') === 'XX',
                    'ì¡´ì¬í•˜ì§€ ì•ŠëŠ” êµ­ê°€ ì½”ë“œ ì²˜ë¦¬ ì„±ê³µ');
                
                // ëŒ€ë¥™ë³„ ë¶„ë¥˜ í…ŒìŠ¤íŠ¸ (ì˜ì–´ í‚¤ ì‚¬ìš©)
                const asianCountries = CountryUtils.getCountriesByContinent('Asia');
                logTest('CountryUtils.getCountriesByContinent', 
                    asianCountries.length > 0 && asianCountries.some(country => country.code === 'JP'),
                    `ì•„ì‹œì•„ êµ­ê°€ ${asianCountries.length}ê°œ ì¡°íšŒë¨`);
                
                // ë¡œê·¸ í•„í„°ë§ í…ŒìŠ¤íŠ¸
                const japanLogs = CountryUtils.filterLogsByCountry(window.mockTravelLogs, 'JP');
                logTest('CountryUtils.filterLogsByCountry', 
                    japanLogs.length === 1 && japanLogs[0].country === 'JP',
                    'ì¼ë³¸ ë¡œê·¸ 1ê°œ í•„í„°ë§ ì„±ê³µ');
                
            } catch (error) {
                logTest('CountryUtils í…ŒìŠ¤íŠ¸', false, '', `ì˜¤ë¥˜: ${error.message}`);
            }
        }
        
        function testStatsUtils() {
            try {
                const { StatsUtils } = window.testModules;
                
                const testData = [1, 2, 3, 4, 5];
                
                // í•©ê³„ í…ŒìŠ¤íŠ¸
                logTest('StatsUtils.sum', 
                    StatsUtils.sum(testData) === 15,
                    `í•©ê³„: ${StatsUtils.sum(testData)} (ì˜ˆìƒ: 15)`);
                
                // í‰ê·  í…ŒìŠ¤íŠ¸
                logTest('StatsUtils.average', 
                    StatsUtils.average(testData, 1) === 3.0,
                    `í‰ê· : ${StatsUtils.average(testData, 1)} (ì˜ˆìƒ: 3.0)`);
                
                // ìµœëŒ€/ìµœì†Œê°’ í…ŒìŠ¤íŠ¸
                logTest('StatsUtils.max', 
                    StatsUtils.max(testData) === 5,
                    `ìµœëŒ€ê°’: ${StatsUtils.max(testData)} (ì˜ˆìƒ: 5)`);
                
                logTest('StatsUtils.min', 
                    StatsUtils.min(testData) === 1,
                    `ìµœì†Œê°’: ${StatsUtils.min(testData)} (ì˜ˆìƒ: 1)`);
                
                // ë¹ˆë„ ë¶„ì„ í…ŒìŠ¤íŠ¸
                const frequencyData = window.mockTravelLogs;
                const purposeFreq = StatsUtils.frequency(frequencyData, 'purpose');
                logTest('StatsUtils.frequency', 
                    purposeFreq.length > 0 && purposeFreq[0].hasOwnProperty('value'),
                    `ëª©ì ë³„ ë¹ˆë„ ë¶„ì„ ì™„ë£Œ (${purposeFreq.length}ê°œ í•­ëª©)`);
                
                // ì¦ê°ë¥  í…ŒìŠ¤íŠ¸
                const changeRate = StatsUtils.changeRate(100, 80, 1);
                logTest('StatsUtils.changeRate', 
                    changeRate.type === 'increase' && changeRate.rate === 25.0,
                    `ì¦ê°ë¥ : ${changeRate.display} (ìœ í˜•: ${changeRate.type})`);
                
            } catch (error) {
                logTest('StatsUtils í…ŒìŠ¤íŠ¸', false, '', `ì˜¤ë¥˜: ${error.message}`);
            }
        }
        
        function testValidationUtils() {
            try {
                const { ValidationUtils } = window.testModules;
                
                // ë¡œê·¸ ê²€ì¦ í…ŒìŠ¤íŠ¸
                const validLog = {
                    country: 'JP',
                    city: 'ë„ì¿„',
                    startDate: '2024-01-15',
                    endDate: '2024-01-20',
                    purpose: 'tourism',
                    rating: 4.5
                };
                
                const validation = ValidationUtils.validateTravelLog(validLog);
                logTest('ValidationUtils.validateTravelLog (ìœ íš¨í•œ ë¡œê·¸)', 
                    validation.isValid === true,
                    `ê²€ì¦ ê²°ê³¼: ${validation.isValid ? 'ìœ íš¨í•¨' : 'ë¬´íš¨í•¨'}`);
                
                // ë¬´íš¨í•œ ë¡œê·¸ í…ŒìŠ¤íŠ¸
                const invalidLog = {
                    country: '',
                    city: '',
                    startDate: 'invalid-date',
                    endDate: '2024-01-15',
                    purpose: 'invalid-purpose',
                    rating: 10
                };
                
                const invalidValidation = ValidationUtils.validateTravelLog(invalidLog);
                logTest('ValidationUtils.validateTravelLog (ë¬´íš¨í•œ ë¡œê·¸)', 
                    invalidValidation.isValid === false && invalidValidation.errors.length > 0,
                    `ê²€ì¦ ì˜¤ë¥˜ ${invalidValidation.errors.length}ê°œ ê°ì§€ë¨`);
                
                // í•„ìˆ˜ í•„ë“œ ê²€ì¦ í…ŒìŠ¤íŠ¸
                logTest('ValidationUtils.isRequired', 
                    ValidationUtils.isRequired('í…ŒìŠ¤íŠ¸') === true && ValidationUtils.isRequired('') === false,
                    'í•„ìˆ˜ í•„ë“œ ê²€ì¦ í†µê³¼');
                
                // ë‚ ì§œ ë²”ìœ„ ê²€ì¦ í…ŒìŠ¤íŠ¸
                logTest('ValidationUtils.isDateInRange', 
                    ValidationUtils.isDateInRange('2024-01-15') === true,
                    'ë‚ ì§œ ë²”ìœ„ ê²€ì¦ í†µê³¼');
                
            } catch (error) {
                logTest('ValidationUtils í…ŒìŠ¤íŠ¸', false, '', `ì˜¤ë¥˜: ${error.message}`);
            }
        }
        
        // ê°„ë‹¨í•œ ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸
        function runServiceTests() {
            logInfo('ğŸ”§ ì„œë¹„ìŠ¤ ê¸°ë³¸ í…ŒìŠ¤íŠ¸ ì‹œì‘');
            testBasicModules();
        }
        
        function testBasicModules() {
            try {
                // ëª¨ë“ˆ ë¡œë“œ í™•ì¸
                logTest('ëª¨ë“ˆ ë¡œë“œ í™•ì¸', 
                    window.testModules && window.testModules.DateUtils,
                    'ëª¨ë“  í…ŒìŠ¤íŠ¸ ëª¨ë“ˆì´ ì •ìƒì ìœ¼ë¡œ ë¡œë“œë¨');
                
                // Mock ë°ì´í„° í™•ì¸
                logTest('Mock ë°ì´í„° í™•ì¸', 
                    window.mockTravelLogs && window.mockTravelLogs.length === 4,
                    `í…ŒìŠ¤íŠ¸ ë°ì´í„° ${window.mockTravelLogs.length}ê°œ ì¤€ë¹„ë¨`);
                
            } catch (error) {
                logTest('ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸', false, '', `ì˜¤ë¥˜: ${error.message}`);
            }
        }
        
        // ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ë“¤
        function runPerformanceTests() {
            logInfo('âš¡ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì‹œì‘');
            testPerformance();
        }
        
        function testPerformance() {
            try {
                const { StatsUtils, DateUtils, CountryUtils } = window.testModules;
                
                // ê¸°ë³¸ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
                const testData = Array.from({length: 1000}, (_, i) => i + 1);
                
                const start1 = performance.now();
                StatsUtils.sum(testData);
                const end1 = performance.now();
                
                logTest('StatsUtils ì„±ëŠ¥ í…ŒìŠ¤íŠ¸', 
                    (end1 - start1) < 100,
                    `1000ê°œ ìˆ«ì í•©ê³„ ê³„ì‚°: ${(end1 - start1).toFixed(2)}ms`);
                
                // ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì²´í¬
                const memoryInfo = performance.memory || {};
                logTest('ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì²´í¬', 
                    true,
                    `ì‚¬ìš© ë©”ëª¨ë¦¬: ${(memoryInfo.usedJSHeapSize / 1024 / 1024).toFixed(2)}MB`);
                
            } catch (error) {
                logTest('ì„±ëŠ¥ í…ŒìŠ¤íŠ¸', false, '', `ì˜¤ë¥˜: ${error.message}`);
            }
        }
        
        // ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
        function runAllTests() {
            clearResults();
            logInfo('ğŸš€ ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹œì‘');
            
            runUtilityTests();
            runServiceTests();
            runPerformanceTests();
            
            logInfo('âœ¨ ì „ì²´ í…ŒìŠ¤íŠ¸ ì™„ë£Œ');
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
        window.addEventListener('load', () => {
            setTimeout(() => {
                logInfo('ğŸ¯ TravelLog Phase 4 í†µí•© í…ŒìŠ¤íŠ¸ê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.');
                logInfo('ìƒë‹¨ì˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”.');
            }, 1000);
        });
    </script>
</body>
</html>
