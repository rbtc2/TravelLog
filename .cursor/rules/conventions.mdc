---
globs: *.js,*.html,*.css
description: TravelLog coding conventions and best practices
---

# ğŸ“ TravelLog Coding Conventions

## ğŸ“‹ Overview
This document outlines the coding conventions, best practices, and standards for the TravelLog project. Follow these guidelines to maintain code consistency and quality.

## ğŸ¯ Core Principles

### 1. **Consistency**
- Use consistent naming conventions across all files
- Follow established patterns and structures
- Maintain uniform code formatting

### 2. **Readability**
- Write self-documenting code
- Use meaningful variable and function names
- Add clear comments for complex logic

### 3. **Maintainability**
- Keep functions small and focused
- Avoid deep nesting and complex logic
- Use modular architecture patterns

### 4. **Performance**
- Optimize for mobile devices
- Minimize DOM manipulation
- Use efficient algorithms and data structures

## ğŸš€ JavaScript Conventions

### **File Structure**
```javascript
/**
 * File description and purpose
 * @version 1.0.0
 * @since 2024-12-29
 */

// 1. Imports (ES6 modules)
import { ModuleName } from './path/to/module.js';

// 2. Constants
const CONSTANT_NAME = 'value';

// 3. Classes/Functions
class ClassName {
    constructor() {
        // Constructor logic
    }
    
    // Public methods
    publicMethod() {
        // Method implementation
    }
    
    // Private methods (prefix with underscore)
    _privateMethod() {
        // Private implementation
    }
}

// 4. Exports
export default ClassName;
```

### **Naming Conventions**

#### **Variables and Functions**
```javascript
// Use camelCase for variables and functions
const userName = 'john_doe';
const isLoggedIn = true;
const travelLogs = [];

function getUserData() { }
function calculateTotalDays() { }
function handleTabSwitch() { }
```

#### **Classes and Constructors**
```javascript
// Use PascalCase for classes and constructors
class TravelLogManager { }
class SearchEngine { }
class CalendarRenderer { }

// Constructor functions
function TravelLogManager() { }
```

#### **Constants**
```javascript
// Use UPPER_SNAKE_CASE for constants
const MAX_LOG_COUNT = 1000;
const API_BASE_URL = 'https://api.travellog.com';
const DEFAULT_PAGE_SIZE = 20;
```

#### **Private Members**
```javascript
// Use underscore prefix for private members
class MyClass {
    constructor() {
        this._privateProperty = 'value';
    }
    
    _privateMethod() {
        // Private method implementation
    }
}
```

### **Function Declarations**

#### **Arrow Functions vs Function Declarations**
```javascript
// Use function declarations for main functions
function processTravelData(data) {
    // Main logic
}

// Use arrow functions for callbacks and short functions
const filteredLogs = logs.filter(log => log.country === 'Japan');
const sortedLogs = logs.sort((a, b) => a.date - b.date);

// Use arrow functions for event handlers
button.addEventListener('click', (event) => {
    handleButtonClick(event);
});
```

#### **Async/Await Pattern**
```javascript
// Prefer async/await over Promises
async function loadTravelLogs() {
    try {
        const response = await fetch('/api/logs');
        const data = await response.json();
        return data;
    } catch (error) {
        console.error('Failed to load travel logs:', error);
        throw error;
    }
}

// Use Promise.all for parallel operations
async function loadMultipleData() {
    try {
        const [logs, countries, settings] = await Promise.all([
            loadTravelLogs(),
            loadCountries(),
            loadSettings()
        ]);
        return { logs, countries, settings };
    } catch (error) {
        console.error('Failed to load data:', error);
    }
}
```

### **Error Handling**

#### **Try-Catch Blocks**
```javascript
// Always use try-catch for async operations
async function saveTravelLog(logData) {
    try {
        const result = await storageManager.saveLog(logData);
        console.log('Travel log saved successfully');
        return result;
    } catch (error) {
        console.error('Failed to save travel log:', error);
        showErrorMessage('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        throw error;
    }
}

// Use try-catch for synchronous operations that might fail
function parseTravelData(jsonString) {
    try {
        return JSON.parse(jsonString);
    } catch (error) {
        console.error('Failed to parse travel data:', error);
        return null;
    }
}
```

#### **Error Messages**
```javascript
// Use Korean for user-facing error messages
const ERROR_MESSAGES = {
    NETWORK_ERROR: 'ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.',
    INVALID_DATA: 'ìœ íš¨í•˜ì§€ ì•Šì€ ë°ì´í„°ì…ë‹ˆë‹¤.',
    SAVE_FAILED: 'ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.',
    LOAD_FAILED: 'ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'
};

// Use English for console logs and debugging
console.error('Failed to initialize search engine:', error);
console.warn('Performance warning: Search took longer than expected');
console.log('Search completed successfully');
```

### **API Integration Error Handling** â­ **NEW**
```javascript
// API-specific error messages (Korean for users)
const API_ERROR_MESSAGES = {
    'Network request failed': 'ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.',
    'API ì‘ë‹µ ì˜¤ë¥˜: 404': 'ìš”ì²­í•œ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
    'API ì‘ë‹µ ì˜¤ë¥˜: 500': 'ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.',
    'API ì‘ë‹µ ì˜¤ë¥˜: 429': 'ë„ˆë¬´ ë§ì€ ìš”ì²­ì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.',
    'API ì‘ë‹µ ì˜¤ë¥˜: 403': 'API ì ‘ê·¼ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.',
    'API ì‘ë‹µ ì˜¤ë¥˜: 401': 'ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.',
    'API ì‘ë‹µ ë°ì´í„° í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.': 'ì„œë²„ì—ì„œ ì˜ëª»ëœ ë°ì´í„°ë¥¼ ë°˜í™˜í–ˆìŠµë‹ˆë‹¤.',
    'Request timeout': 'ìš”ì²­ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.',
    'Failed to fetch': 'ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.',
    'AbortError': 'ìš”ì²­ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.'
};

// Convert API errors to Korean
function getAPIErrorMessage(error) {
    // Check for specific error messages first
    if (API_ERROR_MESSAGES[error.message]) {
        return API_ERROR_MESSAGES[error.message];
    }
    
    // Check for HTTP status codes
    if (error.message.includes('API ì‘ë‹µ ì˜¤ë¥˜:')) {
        const statusMatch = error.message.match(/API ì‘ë‹µ ì˜¤ë¥˜: (\d+)/);
        if (statusMatch) {
            const statusCode = statusMatch[1];
            const statusMessages = {
                '400': 'ì˜ëª»ëœ ìš”ì²­ì…ë‹ˆë‹¤.',
                '401': 'ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.',
                '403': 'ì ‘ê·¼ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.',
                '404': 'ìš”ì²­í•œ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
                '429': 'ë„ˆë¬´ ë§ì€ ìš”ì²­ì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.',
                '500': 'ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.',
                '502': 'ì„œë²„ê°€ ì¼ì‹œì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
                '503': 'ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.',
                '504': 'ìš”ì²­ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.'
            };
            return statusMessages[statusCode] || error.message;
        }
    }
    
    // Check for network errors
    if (error.name === 'TypeError' && error.message.includes('fetch')) {
        return 'ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
    }
    
    if (error.name === 'AbortError') {
        return 'ìš”ì²­ì´ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.';
    }
    
    // Default fallback
    return error.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
}

// API error handling pattern
async function handleAPIOperation(operation, fallbackData = null) {
    try {
        const result = await operation();
        return result;
    } catch (error) {
        console.error('API operation failed:', error);
        
        // Show user-friendly error message
        const userMessage = getAPIErrorMessage(error);
        toastManager.show(userMessage, 'error');
        
        // Return fallback data if available
        if (fallbackData) {
            console.warn('Using fallback data due to API error:', error);
            return fallbackData;
        }
        
        throw error;
    }
}

// API retry pattern with exponential backoff
async function retryAPICall(apiCall, maxRetries = 3, baseDelay = 1000) {
    for (let attempt = 1; attempt <= maxRetries; attempt++) {
        try {
            return await apiCall();
        } catch (error) {
            if (attempt === maxRetries) {
                throw error;
            }
            
            // Exponential backoff: 1s, 2s, 4s
            const delay = baseDelay * Math.pow(2, attempt - 1);
            console.warn(`API call failed (attempt ${attempt}/${maxRetries}), retrying in ${delay}ms:`, error);
            
            await new Promise(resolve => setTimeout(resolve, delay));
        }
    }
}
```

### **Authentication Error Handling** â­ **NEW**
```javascript
// Authentication-specific error messages (Korean for users)
const AUTH_ERROR_MESSAGES = {
    'Invalid login credentials': 'ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.',
    'Email not confirmed': 'ì´ë©”ì¼ ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤. ì´ë©”ì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”.',
    'User already registered': 'ì´ë¯¸ ë“±ë¡ëœ ì´ë©”ì¼ì…ë‹ˆë‹¤.',
    'Password should be at least 6 characters': 'ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.',
    'Invalid email': 'ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.',
    'Signup requires a valid password': 'ìœ íš¨í•œ ë¹„ë°€ë²ˆí˜¸ê°€ í•„ìš”í•©ë‹ˆë‹¤.',
    'User not found': 'ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
    'Too many requests': 'ë„ˆë¬´ ë§ì€ ìš”ì²­ì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.',
    'Network request failed': 'ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.',
    'Invalid API key': 'API í‚¤ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.',
    'Service unavailable': 'ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.'
};

// Convert Supabase errors to Korean
function getErrorMessage(error) {
    return AUTH_ERROR_MESSAGES[error.message] || error.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
}

// Authentication error handling pattern
async function handleAuthOperation(operation) {
    try {
        const result = await operation();
        return result;
    } catch (error) {
        console.error('Authentication operation failed:', error);
        toastManager.show(getErrorMessage(error), 'error');
        throw error;
    }
}
```

### **JSDoc Documentation**

#### **Function Documentation**
```javascript
/**
 * Performs a search across travel logs
 * @param {string} query - Search query string
 * @param {Object} options - Search options
 * @param {string[]} options.filters - Array of filter types
 * @param {string} options.sortBy - Sort criteria
 * @param {number} options.limit - Maximum number of results
 * @returns {Promise<Object>} Search results with metadata
 * @throws {Error} When search query is invalid
 * @example
 * const results = await searchTravelLogs('Japan', {
 *   filters: ['country', 'rating'],
 *   sortBy: 'date',
 *   limit: 20
 * });
 */
async function searchTravelLogs(query, options = {}) {
    // Implementation
}
```

#### **Class Documentation**
```javascript
/**
 * Manages travel log data and operations
 * @class TravelLogManager
 * @version 1.0.0
 * @since 2024-12-29
 */
class TravelLogManager {
    /**
     * Creates an instance of TravelLogManager
     * @param {Object} config - Configuration options
     * @param {string} config.storageKey - Local storage key
     * @param {number} config.maxLogs - Maximum number of logs
     */
    constructor(config = {}) {
        // Constructor implementation
    }
}
```

## ğŸ¨ CSS Conventions

> **Note**: Detailed CSS conventions are now managed in the dedicated [styling.mdc](mdc:.cursor/rules/styling.mdc) and [css-namespace.mdc](mdc:.cursor/rules/css-namespace.mdc) files. This section covers only JavaScript-specific styling considerations.

### **JavaScript CSS Class Management**
```javascript
// Use consistent class naming in JavaScript
const className = 'travel-card';
const modifierClass = 'travel-card--featured';
const elementClass = 'travel-card__header';

// Apply classes conditionally
element.classList.toggle('active', isActive);
element.classList.add('travel-card--featured');
```

### **CSS Variable Usage in JavaScript**
```javascript
// Access CSS variables in JavaScript
const primaryColor = getComputedStyle(document.documentElement)
    .getPropertyValue('--primary-color');

// Set CSS variables dynamically
document.documentElement.style.setProperty('--theme-color', '#667eea');
```

## ğŸŒ HTML Conventions

### **Semantic HTML Structure**
```html
<!-- Use semantic HTML elements -->
<main class="main-content">
    <header class="page-header">
        <h1 class="page-title">ì—¬í–‰ ì¼ì§€</h1>
        <p class="page-description">ì—¬í–‰ì˜ ëª¨ë“  ìˆœê°„ì„ ê¸°ë¡í•˜ì„¸ìš”</p>
    </header>
    
    <section class="content-section">
        <article class="travel-log">
            <h2 class="log-title">ì¼ë³¸ ì—¬í–‰</h2>
            <time class="log-date" datetime="2024-12-29">2024ë…„ 12ì›” 29ì¼</time>
            <p class="log-description">ë„ì¿„ì—ì„œì˜ ì²«ë‚ </p>
        </article>
    </section>
    
    <aside class="sidebar">
        <nav class="filter-nav">
            <h3 class="filter-title">í•„í„°</h3>
            <!-- Filter options -->
        </nav>
    </aside>
</main>
```

### **Accessibility Attributes**
```html
<!-- Always include proper ARIA attributes -->
<button 
    class="action-btn" 
    type="button"
    aria-label="ì—¬í–‰ ì¼ì§€ ì¶”ê°€"
    aria-expanded="false"
    aria-controls="add-log-modal"
>
    <span class="btn-icon" aria-hidden="true">â•</span>
    <span class="btn-text">ì¼ì§€ ì¶”ê°€</span>
</button>

<!-- Use proper form labels -->
<label for="country-select" class="form-label">
    êµ­ê°€ ì„ íƒ
    <span class="required-indicator" aria-label="í•„ìˆ˜ í•­ëª©">*</span>
</label>
<select id="country-select" name="country" required>
    <option value="">êµ­ê°€ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
    <option value="japan">ì¼ë³¸</option>
    <option value="korea">í•œêµ­</option>
</select>
```

### **Data Attributes**
```html
<!-- Use data attributes for JavaScript targeting -->
<div 
    class="travel-card" 
    data-log-id="log-123"
    data-country="japan"
    data-rating="5"
    data-date="2024-12-29"
>
    <!-- Card content -->
</div>

<!-- Use data attributes for tab navigation -->
<nav class="tab-navigation">
    <button 
        class="tab-btn active" 
        data-tab="home"
        aria-selected="true"
        role="tab"
    >
        <span class="tab-icon" aria-hidden="true">ğŸ </span>
        <span class="tab-label">í™ˆ</span>
    </button>
</nav>
```

## ğŸ“± Mobile-First Development

### **Responsive Design Approach**
```css
/* Start with mobile styles */
.component {
    padding: var(--spacing-sm);
    font-size: var(--font-sm);
}

/* Tablet styles */
@media (min-width: 768px) {
    .component {
        padding: var(--spacing-md);
        font-size: var(--font-base);
    }
}

/* Desktop styles */
@media (min-width: 1024px) {
    .component {
        padding: var(--spacing-lg);
        font-size: var(--font-lg);
    }
}
```

### **Touch-Friendly Design**
```css
/* Ensure minimum touch target size */
.touch-target {
    min-width: 44px;
    min-height: 44px;
    padding: var(--spacing-sm);
}

/* Add touch feedback */
.touch-feedback:active {
    transform: scale(0.98);
    opacity: 0.8;
}
```

## ğŸ”§ Performance Guidelines

### **JavaScript Performance**
```javascript
// Use efficient DOM queries
const elements = document.querySelectorAll('.travel-card');
// Cache DOM elements
const cachedElements = {
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('results-container')
};

// Use event delegation for dynamic content
document.addEventListener('click', (event) => {
    if (event.target.matches('.travel-card')) {
        handleCardClick(event.target);
    }
});

// Debounce expensive operations
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

const debouncedSearch = debounce(performSearch, 300);
```

### **CSS Performance**
```css
/* Use efficient selectors */
.travel-card { } /* âœ… Good */
div.travel-card { } /* âŒ Avoid */

/* Use transform and opacity for animations */
.animate {
    transform: translateY(0);
    opacity: 1;
    transition: transform var(--transition-normal), opacity var(--transition-normal);
}

/* Avoid expensive properties in animations */
.animate:hover {
    transform: translateY(-2px); /* âœ… Good */
    /* top: -2px; */ /* âŒ Avoid */
}
```

## ğŸ§ª Testing Conventions

### **Unit Testing Structure**
```javascript
/**
 * Test suite for TravelLogManager
 * @describe TravelLogManager
 */
describe('TravelLogManager', () => {
    let manager;
    
    beforeEach(() => {
        manager = new TravelLogManager();
    });
    
    afterEach(() => {
        manager.cleanup();
    });
    
    /**
     * Test case: Should create travel log successfully
     * @test createTravelLog
     */
    it('should create travel log successfully', async () => {
        // Arrange
        const logData = {
            country: 'Japan',
            city: 'Tokyo',
            startDate: '2024-12-29',
            endDate: '2024-12-31'
        };
        
        // Act
        const result = await manager.createTravelLog(logData);
        
        // Assert
        expect(result).toBeDefined();
        expect(result.id).toBeTruthy();
        expect(result.country).toBe('Japan');
    });
});
```

## ğŸ“Š Code Quality Metrics

### **Function Complexity**
- Keep functions under 20 lines when possible
- Maximum 3 levels of nesting
- Use early returns to reduce complexity

### **File Size Guidelines**
- **JavaScript files**: Under 500 lines
- **HTML files**: Under 200 lines

> **Note**: CSS file size guidelines and module separation rules are now managed in [styling.mdc](mdc:.cursor/rules/styling.mdc).

### **Comment Guidelines**
- Comment complex business logic
- Document public APIs with JSDoc
- Use Korean for user-facing comments
- Use English for technical comments

## ğŸš€ Best Practices Summary

### **DO's**
âœ… Use consistent naming conventions
âœ… Write self-documenting code
âœ… Handle errors gracefully
âœ… Add proper ARIA attributes
âœ… Use semantic HTML elements
âœ… Optimize for performance
âœ… Write comprehensive tests
âœ… Document public APIs

### **DON'Ts**
âŒ Don't ignore error handling
âŒ Don't skip accessibility
âŒ Don't create overly complex functions
âŒ Don't ignore mobile optimization
âŒ Don't use non-semantic HTML
âŒ Don't skip performance considerations
âŒ Don't write untested code
âŒ Don't skip documentation

> **Note**: CSS-specific best practices are now managed in [styling.mdc](mdc:.cursor/rules/styling.mdc) and [css-namespace.mdc](mdc:.cursor/rules/css-namespace.mdc).