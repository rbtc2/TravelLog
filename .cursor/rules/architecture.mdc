---
alwaysApply: true
description: TravelLog project architecture and module structure guidelines
---

# ğŸ—ï¸ TravelLog Architecture Rules

## ğŸ“‹ Project Overview
TravelLog is a modular SPA (Single Page Application) with a 5-tab structure. Each tab operates independently with dynamic module loading for optimal performance.

## ğŸ›ï¸ Core Architecture Principles

### 1. **Modularity** 
- Each feature is separated into independent modules
- Clear interfaces and separation of concerns
- Reusable component design

### 2. **Independence**
- Minimal dependencies between tabs
- Each module manages its own lifecycle
- Isolated state management

### 3. **Scalability**
- Plugin-style tab addition
- Independent version management per module
- Progressive feature expansion

### 4. **Performance**
- Lazy Loading (Lazy Loading)
- Memory-efficient resource management
- Optimized rendering pipeline

## ğŸ“ File Structure Guidelines

### **JavaScript Module Structure**
```
js/
â”œâ”€â”€ app.js                     # Main application entry point
â”œâ”€â”€ config/                    # Configuration files
â”‚   â”œâ”€â”€ app-config.js         # App configuration and metadata
â”‚   â””â”€â”€ form-config.js        # Form configuration
â”œâ”€â”€ data/                      # Data management
â”‚   â””â”€â”€ countries-manager.js   # Country data management
â”œâ”€â”€ modules/                   # Common modules
â”‚   â”œâ”€â”€ search/               # Search system (refactored)
â”‚   â”‚   â”œâ”€â”€ engines/          # Search engines
â”‚   â”‚   â”œâ”€â”€ handlers/         # Event handlers
â”‚   â”‚   â”œâ”€â”€ managers/         # State and data managers
â”‚   â”‚   â”œâ”€â”€ renderers/        # UI renderers
â”‚   â”‚   â”œâ”€â”€ utils/            # Search utilities
â”‚   â”‚   â””â”€â”€ SearchTab.js      # Main search controller
â”‚   â”œâ”€â”€ calendar/             # Calendar module
â”‚   â”‚   â”œâ”€â”€ handlers/         # Event handlers
â”‚   â”‚   â”œâ”€â”€ modals/           # Calendar modals
â”‚   â”‚   â”œâ”€â”€ CalendarDataManager.js
â”‚   â”‚   â”œâ”€â”€ CalendarRenderer.js
â”‚   â”‚   â””â”€â”€ CalendarUtils.js
â”‚   â”œâ”€â”€ services/             # Service layer
â”‚   â”‚   â””â”€â”€ log-service.js    # Log service
â”‚   â”œâ”€â”€ ui-components/        # UI components
â”‚   â”‚   â”œâ”€â”€ country-selector.js
â”‚   â”‚   â”œâ”€â”€ modal-manager.js
â”‚   â”‚   â”œâ”€â”€ pagination-manager.js
â”‚   â”‚   â”œâ”€â”€ toast-manager.js
â”‚   â”‚   â””â”€â”€ view-manager.js
â”‚   â”œâ”€â”€ utils/                # Utility functions
â”‚   â”‚   â”œâ”€â”€ country-data-manager.js
â”‚   â”‚   â”œâ”€â”€ demo-data.js
â”‚   â”‚   â”œâ”€â”€ event-manager.js
â”‚   â”‚   â”œâ”€â”€ search-utility.js
â”‚   â”‚   â””â”€â”€ storage-manager.js
â”‚   â”œâ”€â”€ log-detail.js         # Log detail module
â”‚   â”œâ”€â”€ log-edit.js           # Log edit module
â”‚   â””â”€â”€ repository.js         # Data repository
â””â”€â”€ tabs/                     # Tab modules
    â”œâ”€â”€ home.js              # Home tab
    â”œâ”€â”€ search.js            # Search tab (legacy)
    â”œâ”€â”€ add-log.js           # Add log tab
    â”œâ”€â”€ calendar.js          # Calendar tab
    â””â”€â”€ my-logs/             # My logs tab (modular structure)
        â”œâ”€â”€ controllers/
        â”‚   â””â”€â”€ MyLogsController.js
        â”œâ”€â”€ views/
        â”‚   â”œâ”€â”€ HubView.js
        â”‚   â”œâ”€â”€ LogsListView.js
        â”‚   â”œâ”€â”€ SettingsView.js
        â”‚   â””â”€â”€ TravelReportView.js
        â””â”€â”€ my-logs.js       # Main my-logs entry point
```

### **CSS Structure & Architecture Rules**

#### **ğŸ“ CSS File Organization**
```
styles/
â”œâ”€â”€ main.css                  # ONLY imports - NO direct styles
â”œâ”€â”€ base/                     # Base styles (variables, reset, typography)
â”‚   â”œâ”€â”€ variables.css         # CSS variables and design tokens
â”‚   â”œâ”€â”€ design-tokens.css     # Design system tokens
â”‚   â”œâ”€â”€ reset.css            # CSS reset
â”‚   â”œâ”€â”€ typography.css       # Typography
â”‚   â”œâ”€â”€ layout.css           # Basic layout
â”‚   â”œâ”€â”€ buttons.css          # Basic button styles
â”‚   â”œâ”€â”€ forms.css            # Basic form styles
â”‚   â””â”€â”€ messages.css         # Message styles
â”œâ”€â”€ components/               # Reusable component styles
â”‚   â”œâ”€â”€ buttons.css          # Button components
â”‚   â”œâ”€â”€ cards.css            # Card components
â”‚   â”œâ”€â”€ forms.css            # Form components
â”‚   â”œâ”€â”€ modals.css           # Modal components
â”‚   â”œâ”€â”€ navigation.css       # Navigation components
â”‚   â”œâ”€â”€ country-selector.css # Country selector
â”‚   â”œâ”€â”€ calendar-flag-dots.css # Calendar flag dots
â”‚   â””â”€â”€ common-components.css # Common UI components
â”œâ”€â”€ layouts/                  # Layout-specific styles
â”‚   â”œâ”€â”€ main-layout.css      # Main layout
â”‚   â”œâ”€â”€ tab-content.css      # Tab content layout
â”‚   â””â”€â”€ tab-navigation.css   # Tab navigation layout
â”œâ”€â”€ pages/                    # Page-specific styles (MODULAR)
â”‚   â”œâ”€â”€ home.css             # Home page
â”‚   â”œâ”€â”€ login.css            # Login page
â”‚   â”œâ”€â”€ add-log.css          # Add log page
â”‚   â”œâ”€â”€ search/              # Search page (MODULAR)
â”‚   â”‚   â”œâ”€â”€ search.css       # Main search styles
â”‚   â”‚   â”œâ”€â”€ search-filters.css # Filter-specific styles
â”‚   â”‚   â”œâ”€â”€ search-results.css # Results-specific styles
â”‚   â”‚   â””â”€â”€ search-responsive.css # Search responsive styles
â”‚   â”œâ”€â”€ calendar/            # Calendar page (MODULAR)
â”‚   â”‚   â”œâ”€â”€ calendar-base.css
â”‚   â”‚   â”œâ”€â”€ calendar-grid.css
â”‚   â”‚   â”œâ”€â”€ calendar-bars.css
â”‚   â”‚   â”œâ”€â”€ calendar-navigation.css
â”‚   â”‚   â”œâ”€â”€ calendar-modal.css
â”‚   â”‚   â”œâ”€â”€ calendar-responsive.css
â”‚   â”‚   â”œâ”€â”€ calendar-dark-mode.css
â”‚   â”‚   â””â”€â”€ calendar-animations.css
â”‚   â”œâ”€â”€ my-logs/             # My logs page (MODULAR)
â”‚   â”‚   â”œâ”€â”€ base.css
â”‚   â”‚   â”œâ”€â”€ profile-section.css
â”‚   â”‚   â”œâ”€â”€ hamburger-menu.css
â”‚   â”‚   â”œâ”€â”€ log-views.css
â”‚   â”‚   â”œâ”€â”€ settings.css
â”‚   â”‚   â””â”€â”€ charts.css
â”‚   â”œâ”€â”€ travel-report/       # Travel report page (MODULAR)
â”‚   â”‚   â”œâ”€â”€ world-exploration.css
â”‚   â”‚   â”œâ”€â”€ heatmap.css
â”‚   â”‚   â”œâ”€â”€ basic-stats.css
â”‚   â”‚   â”œâ”€â”€ yearly-stats.css
â”‚   â”‚   â”œâ”€â”€ ranking.css
â”‚   â”‚   â””â”€â”€ travel-report-section.css
â”‚   â”œâ”€â”€ log-detail.css       # Log detail page
â”‚   â”œâ”€â”€ settings.css         # Settings page
â”‚   â”œâ”€â”€ travel-collection.css # Travel collection page
â”‚   â””â”€â”€ error.css            # Error page
â””â”€â”€ utilities/                # Utility styles
    â”œâ”€â”€ accessibility.css    # Accessibility utilities
    â”œâ”€â”€ animations.css       # Animation utilities
    â”œâ”€â”€ dark-mode.css        # Dark mode utilities
    â”œâ”€â”€ navigation-utils.css # Navigation utilities
    â”œâ”€â”€ responsive.css       # Responsive utilities
    â”œâ”€â”€ responsive-optimized.css # Optimized responsive utilities
    â”œâ”€â”€ scroll-optimization.css # Scroll optimization
    â”œâ”€â”€ performance.css      # Performance utilities
    â””â”€â”€ theme-transitions.css # Theme transition utilities
```

#### **ğŸš« CRITICAL CSS Architecture Rules**

##### **1. main.css - Import Only Rule**
```css
/* âœ… CORRECT: main.css should ONLY contain imports */
@import url('./base/variables.css');
@import url('./base/design-tokens.css');
@import url('./base/reset.css');
/* ... other imports ... */

/* âŒ FORBIDDEN: Never add direct styles to main.css */
.some-class { color: red; } /* NEVER DO THIS */
```

##### **2. Modular Page Organization**
- **Each page/tab gets its own directory** under `styles/pages/`
- **Complex pages are split into multiple CSS files** by functionality
- **Each CSS file has a single responsibility**

##### **3. CSS Import Hierarchy**
```css
/* main.css import order (STRICT) */
1. Base styles (variables, reset, typography)
2. Utilities (animations, accessibility, etc.)
3. Components (reusable UI components)
4. Layouts (main layout, tab layouts)
5. Pages (page-specific styles in order of complexity)
```

##### **4. Style Isolation Rules**
- **Page-specific styles MUST be in their respective page directories**
- **NO cross-page style dependencies** (except base/utilities)
- **Each page manages its own responsive design**
- **NO global overrides in main.css**

##### **5. CSS Specificity Guidelines**
- **Use BEM methodology** for component naming
- **Avoid `!important`** unless absolutely necessary
- **Prefer specific selectors** over generic ones
- **Page-specific styles take precedence** over component styles

##### **6. File Naming Conventions**
```
âœ… CORRECT:
- search-filters.css (kebab-case)
- calendar-grid.css (kebab-case)
- world-exploration.css (kebab-case)

âŒ FORBIDDEN:
- searchFilters.css (camelCase)
- calendar_grid.css (snake_case)
- SearchFilters.css (PascalCase)
```

##### **7. CSS Content Rules**
- **Each CSS file must have a clear purpose**
- **Include comments for complex sections**
- **Group related styles together**
- **Use CSS custom properties (variables) consistently**

##### **8. Responsive Design Organization**
- **Mobile-first approach** in all page-specific CSS
- **Responsive styles in the same file** as base styles
- **Use utility classes** for common responsive patterns
- **Avoid duplicate responsive code** across files

##### **9. Dark Mode Implementation**
- **Dark mode styles in the same file** as light mode
- **Use CSS custom properties** for theme switching
- **Consistent dark mode patterns** across all pages

##### **10. Performance Considerations**
- **Minimize CSS file size** by avoiding duplication
- **Use efficient selectors** (avoid deep nesting)
- **Leverage CSS custom properties** for theming
- **Optimize for critical rendering path**

#### **ğŸ” CSS Architecture Violation Checklist**

##### **Before Adding ANY CSS:**
1. **Is this style for a specific page/tab?** â†’ Place in `styles/pages/[page-name]/`
2. **Is this a reusable component?** â†’ Place in `styles/components/`
3. **Is this a utility class?** â†’ Place in `styles/utilities/`
4. **Is this a base style?** â†’ Place in `styles/base/`

##### **NEVER DO:**
- âŒ Add styles directly to `main.css`
- âŒ Create duplicate CSS files
- âŒ Mix page-specific styles in component files
- âŒ Use `!important` without justification
- âŒ Create overly specific selectors
- âŒ Duplicate responsive code across files

##### **ALWAYS DO:**
- âœ… Follow the modular directory structure
- âœ… Use BEM naming convention
- âœ… Include comments for complex sections
- âœ… Group related styles together
- âœ… Use CSS custom properties for theming
- âœ… Test responsive design on all breakpoints

##### **CSS File Size Limits:**
- **main.css**: < 50 lines (imports only)
- **Component files**: < 200 lines
- **Page files**: < 300 lines
- **Utility files**: < 150 lines

##### **Emergency CSS Fix Protocol:**
1. **Identify the correct file** based on functionality
2. **Move styles** to appropriate location
3. **Update imports** in main.css if needed
4. **Test** on all affected pages
5. **Document** the change in commit message

## ğŸ”„ Data Flow Patterns

### 1. **Application Initialization**
```
index.html â†’ app.js â†’ TabManager â†’ Load default tab
```

### 2. **Tab Switching Process**
```
User tab click â†’ TabManager.switchTab() â†’ 
Current tab cleanup() â†’ Load new tab module â†’ 
New tab render() â†’ New tab bindEvents()
```

### 3. **Data Management Flow**
```
UI Event â†’ Event Handler â†’ Service Layer â†’ 
Data Repository â†’ Local Storage â†’ UI Update
```

## ğŸ¯ Design Patterns

### 1. **MVC Pattern**
- **Model**: Data and business logic
- **View**: UI rendering and user interface
- **Controller**: User input handling and state management

### 2. **Observer Pattern**
- Event-based communication
- Loose coupling
- Real-time UI updates

### 3. **Factory Pattern**
- Dynamic tab module creation
- Configuration-based component creation
- Flexible extensibility

### 4. **Strategy Pattern**
- Search algorithm strategies
- Sorting method strategies
- Rendering strategies

## ğŸš€ Performance Optimization

### 1. **Code Splitting**
- Tab-by-tab module separation
- Load only when needed
- Bundle size optimization

### 2. **Memory Management**
- Resource cleanup on tab switch
- Event listener cleanup
- DOM element cleanup

### 3. **Rendering Optimization**
- Virtual scrolling
- Lazy loading
- Image optimization

## ğŸ”§ Module Development Guidelines

### **Tab Module Interface**
Every tab module must implement:
```javascript
class BaseTab {
    constructor() {
        this.isInitialized = false;
        this.container = null;
        this.eventListeners = []; // Event listener tracking
    }
    
    // Required methods
    render(container) { 
        this.container = container;
        this.renderContent();
        this.bindEvents();
        this.isInitialized = true;
    }
    
    renderContent() { /* Implementation required */ }
    bindEvents() { /* Implementation required */ }
    
    // Optional methods (recommended for complex tabs)
    async refresh() { /* Refresh data when tab becomes active */ }
    cleanup() { /* Clean up resources when tab is deactivated */ }
}
```

### **Complex Tab Module Pattern** (for modular tabs like my-logs)
```javascript
class ComplexTab {
    constructor() {
        this.isInitialized = false;
        this.container = null;
        this.eventListeners = [];
        this.controllers = new Map();
        this.views = new Map();
    }
    
    async render(container) {
        this.container = container;
        await this.initializeModules();
        this.renderContent();
        this.bindEvents();
        this.isInitialized = true;
    }
    
    async initializeModules() { /* Initialize controllers and views */ }
    renderContent() { /* Render main content */ }
    bindEvents() { /* Bind event listeners */ }
    cleanup() { /* Clean up all resources */ }
}
```

### **Module Lifecycle**
1. **Initialization**: Module instantiation and setup
2. **Rendering**: UI creation and DOM manipulation
3. **Event Binding**: User interaction handling
4. **Cleanup**: Resource cleanup and memory management

## ğŸ“Š Module Dependencies

### **Core Dependencies**
- [app.js](mdc:js/app.js) - Main application controller
- [app-config.js](mdc:js/config/app-config.js) - Configuration management

### **Common Modules**
- [storage-manager.js](mdc:js/modules/utils/storage-manager.js) - Data persistence
- [event-manager.js](mdc:js/modules/utils/event-manager.js) - Event handling
- [toast-manager.js](mdc:js/modules/ui-components/toast-manager.js) - Notifications

### **Tab-Specific Modules**
- Search: [SearchTab.js](mdc:js/modules/search/SearchTab.js)
- Calendar: [CalendarRenderer.js](mdc:js/modules/calendar/CalendarRenderer.js)
- My Logs: [MyLogsController.js](mdc:js/tabs/my-logs/controllers/MyLogsController.js)

## ğŸ”’ Security Considerations

### 1. **Input Validation**
- User input sanitization
- XSS attack prevention
- CSRF token management

### 2. **Data Protection**
- Sensitive information encryption
- Local storage security
- API key security

## ğŸ§ª Testing Strategy

### 1. **Unit Testing**
- Module-by-module functionality testing
- Utility function testing
- Component testing

### 2. **Integration Testing**
- Inter-tab interaction testing
- Data flow testing
- API integration testing

### 3. **E2E Testing**
- User scenario testing
- Cross-browser testing
- Performance testing

## ğŸ”® Future Architecture Improvements

### 1. **Micro Frontend**
- Independent tab deployment
- Improved version management
- Team-independent development

### 2. **State Management Improvement**
- Global state management introduction
- Improved state synchronization
- Enhanced debugging tools

### 3. **Performance Monitoring**
- Real-time performance metrics
- User behavior analysis
- Automatic optimization