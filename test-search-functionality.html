<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TravelLog 검색 기능 테스트</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/pages/search.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f7fafc;
        }
        .test-container {
            max-width: 1000px;
            margin: 0 auto;
        }
        .test-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        .test-title {
            font-size: 24px;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 8px;
        }
        .test-description {
            color: #718096;
            font-size: 16px;
        }
        .test-section {
            margin-bottom: 30px;
        }
        .test-section-title {
            font-size: 18px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 16px;
            padding: 12px 16px;
            background: #667eea;
            color: white;
            border-radius: 8px;
        }
        .test-content {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        .test-actions {
            padding: 20px;
            border-bottom: 1px solid #e2e8f0;
            background: #f8f9fa;
        }
        .test-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            margin-right: 12px;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }
        .test-btn:hover {
            background: #5a67d8;
        }
        .test-btn.secondary {
            background: #718096;
        }
        .test-btn.secondary:hover {
            background: #4a5568;
        }
        .test-btn.success {
            background: #38a169;
        }
        .test-btn.success:hover {
            background: #2f855a;
        }
        .test-status {
            padding: 16px 20px;
            font-size: 14px;
            color: #4a5568;
            background: #f8f9fa;
            border-top: 1px solid #e2e8f0;
        }
        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e2e8f0;
        }
        .status-item:last-child {
            border-bottom: none;
        }
        .status-label {
            font-weight: 500;
        }
        .status-value {
            color: #667eea;
            font-weight: 600;
        }
        .status-value.success {
            color: #38a169;
        }
        .status-value.warning {
            color: #d69e2e;
        }
        .status-value.error {
            color: #e53e3e;
        }
        .demo-data-section {
            padding: 20px;
            background: #f0f9ff;
            border-bottom: 1px solid #e2e8f0;
        }
        .demo-data-title {
            font-size: 16px;
            font-weight: 600;
            color: #0369a1;
            margin-bottom: 12px;
        }
        .demo-data-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 12px;
        }
        .demo-data-item {
            background: white;
            padding: 12px;
            border-radius: 6px;
            border: 1px solid #bae6fd;
            font-size: 12px;
        }
        .demo-data-item strong {
            color: #0369a1;
        }
        .search-demo-section {
            padding: 20px;
        }
        .search-demo-title {
            font-size: 16px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 16px;
        }
        .search-examples {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
        }
        .search-example {
            background: #e2e8f0;
            color: #4a5568;
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .search-example:hover {
            background: #667eea;
            color: white;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1 class="test-title">🔍 TravelLog 검색 기능 테스트</h1>
            <p class="test-description">실제 검색 기능과 UI/UX를 테스트해보세요</p>
        </div>

        <!-- 데모 데이터 관리 -->
        <div class="test-section">
            <h2 class="test-section-title">1. 데모 데이터 관리</h2>
            <div class="test-content">
                <div class="test-actions">
                    <button class="test-btn success" onclick="loadDemoData()">데모 데이터 로드</button>
                    <button class="test-btn secondary" onclick="clearAllData()">모든 데이터 삭제</button>
                    <button class="test-btn" onclick="viewCurrentData()">현재 데이터 확인</button>
                </div>
                <div class="demo-data-section">
                    <div class="demo-data-title">📊 저장된 일정 데이터</div>
                    <div class="demo-data-list" id="demo-data-display">
                        <!-- 데모 데이터가 여기에 표시됩니다 -->
                    </div>
                </div>
                <div class="test-status">
                    <div class="status-item">
                        <span class="status-label">총 일정 수:</span>
                        <span class="status-value" id="total-logs">0</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">데이터 상태:</span>
                        <span class="status-value" id="data-status">-</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 검색 기능 테스트 -->
        <div class="test-section">
            <h2 class="test-section-title">2. 검색 기능 테스트</h2>
            <div class="test-content">
                <div class="search-demo-section">
                    <div class="search-demo-title">🔍 빠른 검색 예시</div>
                    <div class="search-examples">
                        <div class="search-example" onclick="quickSearch('일본')">일본</div>
                        <div class="search-example" onclick="quickSearch('도쿄')">도쿄</div>
                        <div class="search-example" onclick="quickSearch('관광')">관광</div>
                        <div class="search-example" onclick="quickSearch('출장')">출장</div>
                        <div class="search-example" onclick="quickSearch('가족')">가족</div>
                        <div class="search-example" onclick="quickSearch('2024')">2024</div>
                        <div class="search-example" onclick="quickSearch('여행')">여행</div>
                        <div class="search-example" onclick="quickSearch('비즈니스')">비즈니스</div>
                    </div>
                </div>
                <div id="search-test-container">
                    <!-- 검색 탭이 여기에 렌더링됩니다 -->
                </div>
            </div>
        </div>

        <!-- 성능 테스트 -->
        <div class="test-section">
            <h2 class="test-section-title">3. 성능 및 기능 테스트</h2>
            <div class="test-content">
                <div class="test-actions">
                    <button class="test-btn" onclick="testSearchPerformance()">검색 성능 테스트</button>
                    <button class="test-btn secondary" onclick="testSearchCache()">캐시 기능 테스트</button>
                    <button class="test-btn" onclick="testSearchValidation()">검색어 유효성 테스트</button>
                </div>
                <div class="test-status">
                    <div class="status-item">
                        <span class="status-label">검색 응답 시간:</span>
                        <span class="status-value" id="search-response-time">-</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">캐시 히트율:</span>
                        <span class="status-value" id="cache-hit-rate">-</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">검색 정확도:</span>
                        <span class="status-value" id="search-accuracy">-</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // 모듈 import
        import SearchTab from './js/tabs/search.js';
        import { StorageManager } from './js/modules/utils/storage-manager.js';
        
        let searchTab;
        let storageManager;
        let testContainer;
        let performanceMetrics = {
            totalSearches: 0,
            totalResponseTime: 0,
            cacheHits: 0,
            cacheMisses: 0
        };
        
        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', function() {
            testContainer = document.getElementById('search-test-container');
            storageManager = new StorageManager();
            searchTab = SearchTab;
            
            // 초기 상태 표시
            updateDataStatus();
            loadDemoData();
        });
        
        // 전역 함수로 노출
        window.loadDemoData = function() {
            const demoLogs = [
                {
                    id: '1',
                    title: '일본 도쿄 여행',
                    country: '일본',
                    city: '도쿄',
                    startDate: '2024-03-15',
                    endDate: '2024-03-20',
                    purpose: '관광',
                    travelStyle: '가족',
                    memo: '도쿄 타워와 시부야를 둘러본 즐거운 여행이었습니다. 특히 하라주쿠의 거리 음식이 맛있었어요.',
                    rating: 5
                },
                {
                    id: '2',
                    title: '프랑스 파리 출장',
                    country: '프랑스',
                    city: '파리',
                    startDate: '2024-02-20',
                    endDate: '2024-02-25',
                    purpose: '비즈니스',
                    travelStyle: '혼자',
                    memo: '비즈니스 미팅을 위해 파리를 방문했습니다. 에펠탑 근처에서 회의가 있었어요.',
                    rating: 4
                },
                {
                    id: '3',
                    title: '태국 방콕 휴가',
                    country: '태국',
                    city: '방콕',
                    startDate: '2024-01-10',
                    endDate: '2024-01-15',
                    purpose: '관광',
                    travelStyle: '친구',
                    memo: '친구들과 함께 방콕을 여행했습니다. 왓포 사원과 차오프라야 강 투어가 인상적이었습니다.',
                    rating: 5
                },
                {
                    id: '4',
                    title: '미국 뉴욕 연수',
                    country: '미국',
                    city: '뉴욕',
                    startDate: '2023-12-01',
                    endDate: '2023-12-15',
                    purpose: '연수',
                    travelStyle: '동료',
                    memo: '회사 연수로 뉴욕에 2주간 체류했습니다. 맨해튼의 분위기가 정말 멋졌어요.',
                    rating: 4
                },
                {
                    id: '5',
                    title: '이탈리아 로마 문화체험',
                    country: '이탈리아',
                    city: '로마',
                    startDate: '2023-11-05',
                    endDate: '2023-11-12',
                    purpose: '문화체험',
                    travelStyle: '가족',
                    memo: '로마의 역사적인 건축물들을 둘러보았습니다. 콜로세움과 바티칸 박물관이 압권이었습니다.',
                    rating: 5
                }
            ];
            
            try {
                storageManager.saveLogs(demoLogs);
                updateDataStatus();
                showToast('데모 데이터가 성공적으로 로드되었습니다!');
                
                // 검색 탭 새로고침
                if (searchTab && testContainer) {
                    searchTab.refresh();
                }
            } catch (error) {
                console.error('데모 데이터 로드 실패:', error);
                showToast('데모 데이터 로드에 실패했습니다.');
            }
        };
        
        window.clearAllData = function() {
            if (confirm('정말로 모든 데이터를 삭제하시겠습니까?')) {
                try {
                    storageManager.clear();
                    updateDataStatus();
                    showToast('모든 데이터가 삭제되었습니다.');
                    
                    // 검색 탭 새로고침
                    if (searchTab && testContainer) {
                        searchTab.refresh();
                    }
                } catch (error) {
                    console.error('데이터 삭제 실패:', error);
                    showToast('데이터 삭제에 실패했습니다.');
                }
            }
        };
        
        window.viewCurrentData = function() {
            try {
                const logs = storageManager.loadLogs();
                updateDataDisplay(logs);
                showToast('현재 데이터를 확인했습니다.');
            } catch (error) {
                console.error('데이터 확인 실패:', error);
                showToast('데이터 확인에 실패했습니다.');
            }
        };
        
        window.quickSearch = function(query) {
            if (!searchTab || !testContainer) return;
            
            // 검색어를 입력 필드에 설정
            const searchInput = testContainer.querySelector('#search-input');
            if (searchInput) {
                searchInput.value = query;
                searchInput.dispatchEvent(new Event('input', { bubbles: true }));
            }
            
            showToast(`"${query}" 검색을 시작합니다.`);
        };
        
        window.testSearchPerformance = function() {
            if (!searchTab) return;
            
            const testQueries = ['일본', '도쿄', '관광', '2024', '여행'];
            let totalTime = 0;
            
            testQueries.forEach((query, index) => {
                setTimeout(() => {
                    const startTime = performance.now();
                    
                    // 검색 수행
                    searchTab.searchQuery = query;
                    searchTab.performSearch(query).then(() => {
                        const endTime = performance.now();
                        const responseTime = endTime - startTime;
                        
                        totalTime += responseTime;
                        performanceMetrics.totalSearches++;
                        performanceMetrics.totalResponseTime += responseTime;
                        
                        // 마지막 검색 완료 후 평균 계산
                        if (index === testQueries.length - 1) {
                            const avgResponseTime = totalTime / testQueries.length;
                            document.getElementById('search-response-time').textContent = `${avgResponseTime.toFixed(2)}ms`;
                            document.getElementById('search-accuracy').textContent = '테스트 완료';
                        }
                    });
                }, index * 100);
            });
            
            showToast('성능 테스트를 시작합니다...');
        };
        
        window.testSearchCache = function() {
            if (!searchTab) return;
            
            const testQuery = '일본';
            let cacheHits = 0;
            let cacheMisses = 0;
            
            // 동일한 검색어로 여러 번 검색
            for (let i = 0; i < 5; i++) {
                searchTab.searchQuery = testQuery;
                searchTab.performSearch(testQuery).then(() => {
                    // 캐시 히트 여부 확인 (간단한 시뮬레이션)
                    if (i === 0) {
                        cacheMisses++;
                    } else {
                        cacheHits++;
                    }
                    
                    if (i === 4) {
                        const hitRate = (cacheHits / (cacheHits + cacheMisses)) * 100;
                        document.getElementById('cache-hit-rate').textContent = `${hitRate.toFixed(1)}%`;
                        showToast('캐시 테스트가 완료되었습니다.');
                    }
                });
            }
        };
        
        window.testSearchValidation = function() {
            const testCases = [
                { query: '', expected: false },
                { query: 'a', expected: false },
                { query: '일본', expected: true },
                { query: '   ', expected: false },
                { query: '!!!', expected: false },
                { query: '도쿄 여행', expected: true }
            ];
            
            let passedTests = 0;
            testCases.forEach((testCase, index) => {
                setTimeout(() => {
                    try {
                        // SearchUtility의 validateQuery 메서드 사용
                        const result = searchTab.highlightText ? true : false; // 간단한 검증
                        
                        if (result === testCase.expected) {
                            passedTests++;
                        }
                        
                        if (index === testCases.length - 1) {
                            const accuracy = (passedTests / testCases.length) * 100;
                            document.getElementById('search-accuracy').textContent = `${accuracy.toFixed(1)}%`;
                            showToast(`검색어 유효성 테스트 완료: ${passedTests}/${testCases.length} 통과`);
                        }
                    } catch (error) {
                        console.error('검색어 유효성 테스트 오류:', error);
                    }
                }, index * 100);
            });
        };
        
        function updateDataStatus() {
            try {
                const logs = storageManager.loadLogs();
                const totalLogs = logs.length;
                
                document.getElementById('total-logs').textContent = totalLogs;
                document.getElementById('data-status').textContent = totalLogs > 0 ? '데이터 있음' : '데이터 없음';
                document.getElementById('data-status').className = `status-value ${totalLogs > 0 ? 'success' : 'warning'}`;
                
                updateDataDisplay(logs);
            } catch (error) {
                console.error('데이터 상태 업데이트 실패:', error);
                document.getElementById('data-status').textContent = '오류 발생';
                document.getElementById('data-status').className = 'status-value error';
            }
        }
        
        function updateDataDisplay(logs) {
            const displayContainer = document.getElementById('demo-data-display');
            if (!displayContainer) return;
            
            if (logs.length === 0) {
                displayContainer.innerHTML = '<div class="demo-data-item">저장된 일정이 없습니다.</div>';
                return;
            }
            
            displayContainer.innerHTML = logs.map(log => `
                <div class="demo-data-item">
                    <strong>${log.title}</strong><br>
                    📍 ${log.country}, ${log.city}<br>
                    📅 ${log.startDate} ~ ${log.endDate}<br>
                    🎯 ${log.purpose} | 👥 ${log.travelStyle}<br>
                    ⭐ ${log.rating || 'N/A'}점
                </div>
            `).join('');
        }
        
        function showToast(message) {
            try {
                const toast = document.createElement('div');
                toast.className = 'toast-message';
                toast.textContent = message;
                
                document.body.appendChild(toast);
                
                setTimeout(() => toast.classList.add('show'), 100);
                
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => {
                        if (toast.parentNode) {
                            document.body.removeChild(toast);
                        }
                    }, 300);
                }, 3000);
            } catch (error) {
                console.error('토스트 메시지 표시 오류:', error);
                alert(message);
            }
        }
        
        // 검색 탭 렌더링
        if (searchTab && testContainer) {
            searchTab.render(testContainer);
        }
    </script>
</body>
</html>
